"use strict";(self.webpackChunkenergy_balance_wo_watch=self.webpackChunkenergy_balance_wo_watch||[]).push([[211],{7211:(e,t,n)=>{n.r(t),n.d(t,{default:()=>W});var a=n(2555),i=n(5043),s=n(3216),o=n(5472),l=n(303),r=(n(1775),n(579));const c=e=>{let{selectedMeal:t,onServingSelect:n,currentServing:a,currentUnit:i="g"}=e;if(!t||!t.nutritional_metrics)return null;const{serving_options:s}=t.nutritional_metrics,o=e=>{switch(e){case"ml":return"\ud83e\udd64";case"g":return"\u2696\ufe0f";case"oz":return"\ud83e\udd5b";default:return"\ud83d\udccf"}};return(0,r.jsxs)("div",{className:"serving-suggestions",children:[(0,r.jsx)("h4",{children:"\ud83d\udccf Serving Size Suggestions"}),s&&Object.keys(s).length>0&&(0,r.jsxs)("div",{className:"serving-category",children:[(0,r.jsx)("h5",{children:"Standard Serving Options"}),(0,r.jsx)("div",{className:"serving-buttons",children:Object.entries(s).map((e=>{let[t,s]=e;const l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"g";return parseFloat(a)===parseFloat(e)&&(i||"g")===(t||"g")}(s.weight,s.unit||"g");return(0,r.jsxs)("button",{className:"serving-button ".concat(l?"selected":""),onClick:()=>function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"g";console.log("Serving button clicked:",{weight:e,description:t,unit:a}),n&&"function"===typeof n?n(e,t,a):console.error("onServingSelect is not a function:",n)}(s.weight,s.description,s.unit||"g"),title:s.description,"data-unit":s.unit||"g","data-selected":l,children:[(0,r.jsx)("span",{className:"serving-icon",children:o(s.unit||"g")}),(0,r.jsxs)("span",{className:"serving-weight",children:[s.weight,s.unit||"g"]}),(0,r.jsx)("span",{className:"serving-description",children:s.description})]},"standard-".concat(t,"-").concat(s.weight,"-").concat(s.unit||"g"))}))})]}),(0,r.jsxs)("div",{className:"serving-note",children:[(0,r.jsx)("small",{children:"\ud83d\udca1 Click any suggestion to automatically set the serving size and update nutrition values"}),(0,r.jsx)("small",{children:"\u26a1 Liquid measurements (ml) are converted to equivalent weights for accurate nutrition calculation"}),a&&i&&(0,r.jsx)("div",{className:"current-selection",children:(0,r.jsxs)("small",{children:[(0,r.jsx)("strong",{children:"Current:"})," ",a,i]})})]})]})},d=e=>{let{foodName:t,mealData:n}=e;if(n&&(n.longCovidRelevance||n.longCovidBenefits||n.longCovidCautions)){const e=n.longCovidRelevance||{},a=n.longCovidBenefits||[],i=n.longCovidCautions||[],s=n.functionalCompounds||{};let o="neutral";a.length>i.length&&(o="beneficial"),i.length>a.length&&(o="caution");const l=e.antiInflammatory||"unknown";return(0,r.jsxs)("div",{className:"long-covid-food-info ".concat(o),children:[(0,r.jsxs)("div",{className:"food-info-header",children:[(0,r.jsx)("span",{className:"category-icon ".concat(o),children:"beneficial"===o?"\u2705":"caution"===o?"\u26a0\ufe0f":"\u2139\ufe0f"}),(0,r.jsxs)("strong",{children:["Database Analysis: ",t]})]}),(0,r.jsxs)("div",{className:"inflammatory-level",children:[(0,r.jsx)("h5",{children:"\ud83d\udd25 Anti-Inflammatory Level"}),(0,r.jsxs)("div",{className:"level-indicator level-".concat(l),children:[(0,r.jsxs)("span",{className:"level-value",children:[" ",l.toUpperCase()]}),(0,r.jsx)("span",{className:"level-description",children:"high"===l?"Excellent for reducing inflammation":"moderate"===l?"Moderately helpful for inflammation":"low"===l?"Limited anti-inflammatory effects":"neutral"===l?"No significant inflammatory impact":"Not assessed"})]})]}),Object.keys(s).length>0&&(0,r.jsxs)("div",{className:"functional-compounds",children:[(0,r.jsx)("h5",{children:"\ud83e\uddec Functional Compounds"}),(0,r.jsx)("div",{className:"compounds-grid",children:Object.entries(s).map((e=>{let[t,n]=e;return(0,r.jsxs)("div",{className:"compound-item",children:[(0,r.jsx)("span",{className:"compound-name",children:t.replace(/_/g," ")}),(0,r.jsxs)("span",{className:"compound-level level-".concat(n),children:[" ",n]})]},t)}))})]}),a.length>0&&(0,r.jsxs)("div",{className:"benefits-list",children:[(0,r.jsx)("h5",{children:"\u2728 Benefits for Long COVID Recovery"}),(0,r.jsx)("ul",{children:a.map(((e,t)=>(0,r.jsx)("li",{children:e},t)))})]}),i.length>0&&(0,r.jsxs)("div",{className:"cautions-list",children:[(0,r.jsx)("h5",{children:"\u26a0\ufe0f Important Considerations"}),(0,r.jsx)("ul",{children:i.map(((e,t)=>(0,r.jsx)("li",{children:e},t)))})]})]})}return(0,r.jsxs)("div",{className:"no-food-info",children:[(0,r.jsx)("div",{className:"no-data-icon",children:"\ud83d\udcca"}),(0,r.jsx)("h4",{children:"No Long COVID Data Available"}),(0,r.jsx)("p",{children:"This food doesn't have specific Long COVID information in our database yet."}),(0,r.jsx)("p",{children:"Consider general anti-inflammatory principles:"}),(0,r.jsxs)("ul",{className:"general-tips",children:[(0,r.jsx)("li",{children:"Choose whole, unprocessed versions when possible"}),(0,r.jsx)("li",{children:"Pay attention to how it affects your symptoms"}),(0,r.jsx)("li",{children:"Consider portion sizes and frequency"}),(0,r.jsx)("li",{children:"Pair with known anti-inflammatory foods"})]})]})},m=e=>{let{selectedFood:t,selectedMeal:n,foodLog:a=[],isSearching:i=!1,searchTerm:s=""}=e;return t&&n?(0,r.jsxs)("div",{className:"long-covid-side-panel",children:[(0,r.jsx)("h3",{children:"\ud83e\udda0 Long COVID Nutrition Guide"}),(0,r.jsxs)("div",{className:"selected-food-analysis",children:[(0,r.jsx)(d,{foodName:t,mealData:n}),(0,r.jsx)("div",{className:"back-to-guide",children:(0,r.jsx)("p",{className:"guide-hint",children:(0,r.jsx)("em",{children:"Clear selection to see the full nutrition guide"})})})]})]}):i&&s.length>=2?(0,r.jsxs)("div",{className:"long-covid-side-panel",children:[(0,r.jsx)("h3",{children:"\ud83e\udda0 Long COVID Nutrition Guide"}),(0,r.jsx)("div",{className:"search-status",children:(0,r.jsx)("p",{className:"search-hint",children:(0,r.jsxs)("em",{children:['Searching for "',s,'"... Select a food above to see its specific analysis.']})})}),(0,r.jsx)("div",{className:"nutrition-categories",children:(0,r.jsxs)("div",{className:"category-section beneficial",children:[(0,r.jsx)("h4",{children:"\u2705 Quick Anti-Inflammatory Guide"}),(0,r.jsx)("p",{children:"Focus on omega-3 rich fish, berries, leafy greens, and anti-inflammatory spices."})]})})]}):(0,r.jsxs)("div",{className:"long-covid-side-panel",children:[(0,r.jsx)("h3",{children:"\ud83e\udda0 Long COVID Nutrition Guide"}),(0,r.jsxs)("div",{className:"nutrition-categories",children:[(0,r.jsxs)("div",{className:"category-section beneficial",children:[(0,r.jsx)("h4",{children:"\u2705 Anti-Inflammatory Foods"}),(0,r.jsxs)("ul",{children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Fatty Fish:"})," Salmon, mackerel, sardines (omega-3s)"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Berries:"})," Blueberries, strawberries (antioxidants)"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Leafy Greens:"})," Spinach, kale (vitamins, minerals)"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Nuts:"})," Walnuts, almonds (healthy fats)"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Turmeric:"})," Contains curcumin (anti-inflammatory)"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Ginger:"})," Natural anti-inflammatory"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Green Tea:"})," Polyphenols reduce inflammation"]})]})]}),(0,r.jsxs)("div",{className:"category-section neutral",children:[(0,r.jsx)("h4",{children:"\u2139\ufe0f Recommended Foods"}),(0,r.jsxs)("ul",{children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Whole Grains:"})," Oats, quinoa, brown rice"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Lean Proteins:"})," Chicken, turkey, legumes"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Citrus Fruits:"})," High in vitamin C"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Olive Oil:"})," Monounsaturated fats"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Garlic & Onions:"})," Immune support"]})]})]}),(0,r.jsxs)("div",{className:"category-section caution",children:[(0,r.jsx)("h4",{children:"\u26a0\ufe0f Foods to Limit"}),(0,r.jsxs)("ul",{children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Processed Foods:"})," High in inflammation-promoting ingredients"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Refined Sugars:"})," Can worsen inflammation"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Red/Processed Meat:"})," May increase inflammatory markers"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Trans Fats:"})," Found in margarine, processed foods"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Refined Carbs:"})," White bread, pastries"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Fried Foods:"})," High in inflammatory compounds"]})]})]})]}),(0,r.jsxs)("div",{className:"additional-tips",children:[(0,r.jsx)("h4",{children:"\ud83d\udca1 General Tips"}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:"Stay well hydrated (8+ glasses water daily)"}),(0,r.jsx)("li",{children:"Consider vitamin D supplementation"}),(0,r.jsx)("li",{children:"Eat regular, smaller meals to maintain energy"}),(0,r.jsx)("li",{children:"Focus on nutrient-dense, whole foods"}),(0,r.jsx)("li",{children:"Limit alcohol and caffeine if they worsen symptoms"})]})]})]})},u=e=>{let{search:t,setSearch:n,suggestions:a,setSuggestions:i,selectedMeal:s,setSelectedMeal:o,searchFocused:l,setSearchFocused:d,renderSearchInput:u,handleSelectMeal:h,clearSearch:g,fields:p,setFields:v,mealType:f,setMealType:x,time:y,setTime:j,date:b,setDate:N,longCovidAdjust:C,setLongCovidAdjust:w,editingEntry:k,handleCancelEdit:S,handleFieldChange:A,handleServingSelection:F,handleTimeChange:D,convertTo24Hour:_,handleLogFood:L,loading:E,success:M,error:I,mealTypes:T,pyodideStatus:O,foodLog:z,MicronutrientRadarChart:B}=e;return(0,r.jsxs)("div",{className:"food-form-section",children:[(0,r.jsxs)("div",{className:"food-form-left",children:[k&&(0,r.jsxs)("div",{className:"edit-mode-banner",children:[(0,r.jsxs)("div",{className:"edit-indicator",children:[(0,r.jsx)("span",{className:"edit-icon",children:"\u270f\ufe0f"}),(0,r.jsxs)("span",{className:"edit-text",children:[(0,r.jsx)("strong",{children:"Editing:"})," ",k.name]})]}),(0,r.jsx)("button",{className:"cancel-edit-btn",onClick:S,type:"button",children:"Cancel Edit"})]}),(0,r.jsxs)("div",{className:"form-group long-covid-checkbox-group",children:[(0,r.jsxs)("label",{className:"long-covid-checkbox-label",children:[(0,r.jsx)("input",{type:"checkbox",checked:C,onChange:e=>w(e.target.checked),className:"long-covid-checkbox"}),(0,r.jsx)("span",{className:"checkbox-text",children:"I have Long COVID - Show food recommendations and adjustments"})]}),C&&(0,r.jsx)("div",{className:"long-covid-info-banner",children:(0,r.jsxs)("p",{children:["\ud83d\udd2c ",(0,r.jsx)("strong",{children:"Long COVID Mode:"})," Food recommendations will be adjusted to focus on anti-inflammatory options that may help manage symptoms and support recovery."]})})]}),u(),s&&(0,r.jsx)(c,{selectedMeal:s,onServingSelect:F,currentServing:p.serving,currentUnit:p.servingUnit||"g"}),(0,r.jsxs)("div",{className:"form-row",children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("input",{name:"protein",value:p.protein||"",onChange:A,type:"number",step:"0.1",placeholder:" ",readOnly:s}),(0,r.jsx)("label",{children:"Protein (g)"})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("input",{name:"carbs",value:p.carbs||"",onChange:A,type:"number",step:"0.1",placeholder:" ",readOnly:s}),(0,r.jsx)("label",{children:"Carbs (g)"})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("input",{name:"fat",value:p.fat||"",onChange:A,type:"number",step:"0.1",placeholder:" ",readOnly:s}),(0,r.jsx)("label",{children:"Fat (g)"})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("input",{name:"serving",value:p.serving||"",onChange:A,type:"number",step:"1",className:"serving-input",placeholder:" "}),(0,r.jsx)("label",{children:"Serving (g)"})]})]}),(0,r.jsxs)("div",{className:"form-row",children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"meal-type",children:"Meal Type"}),(0,r.jsx)("select",{id:"meal-type",value:f,onChange:e=>x(e.target.value),children:T.map((e=>(0,r.jsx)("option",{value:e,children:e},e)))})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("input",{type:"time",value:_(y),onChange:D,placeholder:" "}),(0,r.jsx)("label",{children:"Time"})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("input",{type:"date",value:b,onChange:e=>N(e.target.value),placeholder:" "}),(0,r.jsx)("label",{children:"Date"})]})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("input",{name:"calories",value:p.calories||"",onChange:A,type:"number",step:"1",placeholder:" "}),(0,r.jsx)("label",{children:"Calories"})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("button",{className:"submit-button ".concat(k?"update-mode":""),onClick:L,disabled:E||!p.name,children:E?k?"Updating...":"Logging...":k?"Update Food":"Log Food"}),M&&(0,r.jsx)("div",{className:"success-message",children:M}),I&&(0,r.jsx)("div",{className:"error-message",children:I})]})]}),(0,r.jsxs)("div",{className:"food-form-right",children:[C&&(0,r.jsx)(m,{selectedFood:p.name,selectedMeal:s,foodLog:z,isSearching:t.length>=2&&!s,searchTerm:t}),s&&p.micronutrients&&Object.keys(p.micronutrients).length>0&&(0,r.jsx)(B,{micronutrients:p.micronutrients,selectedMeal:s}),!C&&(0,r.jsxs)("div",{className:"general-nutrition-info",children:[(0,r.jsx)("h3",{children:"\ud83d\udcca Nutrition Tips"}),(0,r.jsx)("p",{children:"Enable Long COVID mode above to get personalized food recommendations and anti-inflammatory guidance."}),"ready"===O&&(0,r.jsx)("div",{className:"ai-tip",children:(0,r.jsxs)("p",{children:["\ud83d\udca1 ",(0,r.jsx)("strong",{children:"AI Tip:"})," The search above uses machine learning to find the most relevant foods for your queries!"]})})]})]})]})},h=e=>{let{entryId:t,entryName:n,onConfirm:a,onCancel:i,deleteLoading:s}=e;return(0,r.jsx)("div",{className:"modal-overlay",children:(0,r.jsxs)("div",{className:"delete-confirm-modal",children:[(0,r.jsx)("h3",{children:"Delete Food Entry"}),(0,r.jsx)("p",{children:"Are you sure you want to delete this food entry?"}),(0,r.jsx)("div",{className:"entry-preview",children:(0,r.jsx)("strong",{children:n})}),(0,r.jsx)("p",{className:"warning-text",children:"This action cannot be undone."}),(0,r.jsxs)("div",{className:"modal-actions",children:[(0,r.jsx)("button",{className:"cancel-button",onClick:i,disabled:s,children:"Cancel"}),(0,r.jsx)("button",{className:"delete-button",onClick:()=>a(t),disabled:s,children:s?"Deleting...":"Delete Entry"})]})]})})},g=e=>{var t;let{foodLog:n,journalPage:a,logLoading:i,journalError:s,success:o,deleteConfirmId:l,setDeleteConfirmId:c,deleteLoading:d,handleDeleteEntry:m,fetchFoodLog:u,handleEditEntry:g,ENTRIES_PER_PAGE:p,formatDateHeader:v}=e;const f=e=>{if(!e)return"12:00";const[t,n]=e.split(" ");if(!t||!n)return e;let[a,i]=t.split(":"),s=parseInt(a,10);return"AM"===n.toUpperCase()?12===s&&(s=0):"PM"===n.toUpperCase()&&12!==s&&(s+=12),"".concat(s.toString().padStart(2,"0"),":").concat(i)},x=e=>{switch(e){case"Breakfast":return"B";case"Morning Snack":return"MS";case"Lunch":return"L";case"Afternoon Snack":return"AS";case"Dinner":return"D";case"Late Night Snack":return"LN";case"Snack":return"S";default:return e.charAt(0)}};return(0,r.jsxs)("div",{className:"food-journal-section",children:[l&&(0,r.jsx)(h,{entryId:l,entryName:(null===(t=n.find((e=>e.id===l)))||void 0===t?void 0:t.name)||"Unknown",onConfirm:m,onCancel:()=>c(null),deleteLoading:d}),(0,r.jsxs)("div",{className:"journal-header",children:[(0,r.jsx)("h3",{children:"Your Food Journal"}),(0,r.jsx)("button",{className:"refresh-button",onClick:()=>u(1),disabled:i,children:i?"Loading...":"Refresh"})]}),s&&(0,r.jsx)("div",{className:"error-message",children:s}),o&&(0,r.jsx)("div",{className:"success-message",children:o}),i&&0===n.length?(0,r.jsx)("div",{className:"loading-indicator",children:"Loading your food journal..."}):0===n.length?(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("p",{children:"No entries found in your food journal."}),(0,r.jsx)("p",{children:'Start by adding a meal in the "Add Food" tab!'})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"journal-summary",children:(0,r.jsxs)("p",{children:["Showing ",n.length," meal entries"]})}),(0,r.jsx)("div",{className:"journal-table-container",children:(()=>{const e=[...n].sort(((e,t)=>{if(e.date!==t.date)return t.date.localeCompare(e.date);const n=f(e.time),a=f(t.time);return n.localeCompare(a)})),t={};return e.forEach((e=>{t[e.date]||(t[e.date]=[]),t[e.date].push(e)})),(0,r.jsx)("div",{className:"journal-by-day",children:Object.entries(t).map((e=>{let[t,n]=e;const a=(e=>e.reduce(((e,t)=>(e.calories+=parseFloat(t.calories)||0,e.protein+=parseFloat(t.protein)||0,e.carbs+=parseFloat(t.carbs)||0,e.fat+=parseFloat(t.fat)||0,e.meals+=1,e)),{calories:0,protein:0,carbs:0,fat:0,meals:0}))(n);return(0,r.jsxs)("div",{className:"day-group",children:[(0,r.jsxs)("div",{className:"day-header",children:[(0,r.jsxs)("div",{className:"day-header-left",children:[(0,r.jsx)("h4",{className:"day-title",children:v(t)}),(0,r.jsxs)("span",{className:"day-meal-count",children:[a.meals," meal",1!==a.meals?"s":""]})]}),(0,r.jsxs)("div",{className:"day-totals",children:[(0,r.jsxs)("div",{className:"day-total-item",children:[(0,r.jsx)("span",{className:"total-label",children:"Total:"}),(0,r.jsxs)("span",{className:"total-value",children:[Math.round(a.calories)," cal"]})]}),(0,r.jsxs)("div",{className:"day-total-macros",children:[(0,r.jsxs)("span",{className:"macro-total",children:["P: ",a.protein.toFixed(1),"g"]}),(0,r.jsxs)("span",{className:"macro-total",children:["C: ",a.carbs.toFixed(1),"g"]}),(0,r.jsxs)("span",{className:"macro-total",children:["F: ",a.fat.toFixed(1),"g"]})]})]})]}),(0,r.jsxs)("table",{className:"food-log-table day-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"time-col",children:"Time"}),(0,r.jsx)("th",{className:"meal-type-col",children:"Meal"}),(0,r.jsx)("th",{className:"food-col",children:"Food"}),(0,r.jsx)("th",{className:"serving-col",children:"Serving"}),(0,r.jsx)("th",{className:"macro-col",children:"P"}),(0,r.jsx)("th",{className:"macro-col",children:"C"}),(0,r.jsx)("th",{className:"macro-col",children:"F"}),(0,r.jsx)("th",{className:"calories-col",children:"Cal"}),(0,r.jsx)("th",{className:"efficiency-col",children:"Eff%"}),(0,r.jsx)("th",{className:"actions-col",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:n.map(((e,t)=>(0,r.jsxs)("tr",{className:"meal-row ".concat(0===t?"first-meal":""),children:[(0,r.jsx)("td",{className:"time-cell",children:(0,r.jsx)("span",{className:"meal-time",children:e.time.replace(":00","").replace(" ","")})}),(0,r.jsx)("td",{className:"meal-type-cell",children:(0,r.jsx)("span",{className:"meal-badge ".concat((e.mealType||"unknown").trim().toLowerCase().replace(/\s+/g,"-")),children:x(e.mealType||"Unknown")})}),(0,r.jsx)("td",{className:"food-cell",title:e.name,children:(0,r.jsx)("span",{className:"food-name",children:e.name.length>25?"".concat(e.name.substring(0,25),"..."):e.name})}),(0,r.jsxs)("td",{className:"serving-cell",children:[e.serving||"0","g"]}),(0,r.jsx)("td",{className:"macro-cell",children:"number"===typeof e.protein?e.protein.toFixed(1):e.protein||"0"}),(0,r.jsx)("td",{className:"macro-cell",children:"number"===typeof e.carbs?e.carbs.toFixed(1):e.carbs||"0"}),(0,r.jsx)("td",{className:"macro-cell",children:"number"===typeof e.fat?e.fat.toFixed(1):e.fat||"0"}),(0,r.jsx)("td",{className:"calories-cell",children:(0,r.jsx)("strong",{children:e.calories||"0"})}),(0,r.jsx)("td",{className:"efficiency-cell",children:(0,r.jsx)("span",{className:"efficiency-badge ".concat("number"===typeof e.metabolicEfficiency?e.metabolicEfficiency>=80?"high":e.metabolicEfficiency>=60?"medium":"low":"unknown"),children:"number"===typeof e.metabolicEfficiency?e.metabolicEfficiency.toFixed(0):"N/A"})}),(0,r.jsx)("td",{className:"actions-cell",children:(0,r.jsxs)("div",{className:"action-buttons compact",children:[(0,r.jsx)("button",{className:"edit-btn compact",onClick:()=>g(e),title:"Edit entry",children:"\u270f\ufe0f"}),(0,r.jsx)("button",{className:"delete-btn compact",onClick:()=>c(e.id),title:"Delete entry",children:"\ud83d\uddd1\ufe0f"})]})})]},e.id)))})]})]},t)}))})})()}),n.length>=a*p&&(0,r.jsx)("div",{className:"load-more-container",children:(0,r.jsx)("button",{className:"load-more-button",onClick:()=>u(a+1),disabled:i,children:i?"Loading...":"Load More Entries"})})]})]})};var p=n(7523);const v=(e,t)=>{const n=e.time,a=n.match(/(\d+):/),i=a?parseInt(a[1],10):12,s=n.toLowerCase().includes("pm");let o=i;s&&12!==i&&(o+=12),s||12!==i||(o=0);const l=.2*(parseFloat(e.protein)||0),r=.1*(parseFloat(e.carbs)||0),c=.15*(parseFloat(e.fat)||0);let d=1;o<6||o>20?d=.7:o>=7&&o<=10?d=1.2:o>=17&&o<=19&&(d=.9);const m={Breakfast:1.3,"Morning Snack":.9,Lunch:1.1,"Afternoon Snack":.8,Dinner:.9,"Late Night Snack":.6}[e.mealType]||1;let u=Math.min(100,10*(l+r+c))*d*m;if(e.longCovidAdjust&&null!==t&&void 0!==t&&t.hasLongCovid){u*={mild:.95,moderate:.85,severe:.75,"very severe":.65}[null===(h=t.longCovidSeverity)||void 0===h?void 0:h.toLowerCase()]||.85,e.longCovidBenefits&&e.longCovidBenefits.length>0&&(u*=1.1),e.longCovidCautions&&e.longCovidCautions.length>0&&(u*=.9)}var h;return Math.min(100,Math.max(0,u))},f=e=>{const t=e.split("-");return new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]))},x=e=>{const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(a)};const y={vitamin_a:{value:900,unit:"mcg",femaleAdjust:.78,description:"Supports vision, immune function, and cell growth"},vitamin_c:{value:90,unit:"mg",femaleAdjust:.83,description:"Antioxidant that supports immune function and collagen production"},vitamin_d:{value:15,unit:"mcg",femaleAdjust:1,description:"Crucial for calcium absorption and bone health"},vitamin_e:{value:15,unit:"mg",femaleAdjust:1,description:"Antioxidant that protects cells from damage"},vitamin_k:{value:120,unit:"mcg",femaleAdjust:.75,description:"Essential for blood clotting and bone health"},vitamin_b6:{value:1.3,unit:"mg",femaleAdjust:1,description:"Important for metabolism and brain development"},vitamin_b12:{value:2.4,unit:"mcg",femaleAdjust:1,description:"Essential for nerve function and blood cell formation"},folate:{value:400,unit:"mcg",femaleAdjust:1,description:"Critical for cell division and DNA synthesis"},iron:{value:8,unit:"mg",femaleAdjust:2.25,description:"Essential for oxygen transport in the blood"},calcium:{value:1e3,unit:"mg",femaleAdjust:1,description:"Critical for bone health and muscle function"},magnesium:{value:420,unit:"mg",femaleAdjust:.76,description:"Involved in over 300 biochemical reactions in the body"},zinc:{value:11,unit:"mg",femaleAdjust:.73,description:"Important for immune function and wound healing"},selenium:{value:55,unit:"mcg",femaleAdjust:1,description:"Antioxidant that helps protect cells from damage"},copper:{value:.9,unit:"mg",femaleAdjust:1,description:"Important for red blood cell formation and nerve function"},potassium:{value:3500,unit:"mg",femaleAdjust:.86,description:"Essential for heart function and blood pressure regulation"},phosphorus:{value:700,unit:"mg",femaleAdjust:1,description:"Important for bone and teeth formation and energy storage"},vitamin_b1:{value:1.2,unit:"mg",femaleAdjust:.92,description:"Essential for energy metabolism"},vitamin_b2:{value:1.3,unit:"mg",femaleAdjust:.85,description:"Important for energy production and cell function"},vitamin_b3:{value:16,unit:"mg",femaleAdjust:.875,description:"Helps convert food into energy"},manganese:{value:2.3,unit:"mg",femaleAdjust:.78,description:"Important for bone development and wound healing"}};function j(e){let{userData:t,userIntake:n={}}=e;const s=(0,i.useRef)(null),[o,l]=(0,i.useState)(null),c=(0,i.useCallback)((e=>{const t=(e,t)=>e&&t?e/Math.pow(t/100,2):null,n=(e=>{const{age:n,gender:a,weight:i,height:s,activity_level:o}=e;if(!n||!i||!s)return 2e3;let l;l="female"===a?10*i+6.25*s-5*n-161:10*i+6.25*s-5*n+5;let r=l*({sedentary:1.2,light:1.375,moderate:1.55,very:1.725,extreme:1.9}[o]||1.375);e.covid_condition&&(r*=1.07);const c=t(i,s);return c&&(c<18.5?r*=1.1:c>30&&(r*=.9)),Math.round(r)})(e),a=((e,n)=>{if(!e)return null;let a=.25,i=.45,s=.3;n.covid_condition&&(a=.3,i=.4,s=.3);const o=t(n.weight,n.height);if(o&&o<18.5&&(s=.35,i=.45,a=.2),o&&o>30&&(a=.35,i=.35,s=.3),n.age>65){a=Math.min(a+.05,.4);const e=1-a;i=e*(i/(i+s)),s=e*(s/(i+s))}return{protein:a,carbs:i,fat:s}})(n,e),i=(n*a.protein/4).toFixed(1),s=(n*a.carbs/4).toFixed(1),o=(n*a.fat/9).toFixed(1),l="Increased to support immune function and tissue repair",r="Focus on complex carbs with anti-inflammatory properties",c="Higher proportion of omega-3s recommended to reduce inflammation";return{protein:{value:parseFloat(i),covidNote:e.covid_condition?l:null},carbs:{value:parseFloat(s),covidNote:e.covid_condition?r:null},fat:{value:parseFloat(o),covidNote:e.covid_condition?c:null},calories:{value:n}}}),[]);return(0,i.useEffect)((()=>{if(t){const e=c(t);l(e)}}),[t,c]),(0,i.useEffect)((()=>{if(s.current&&o&&n)try{(0,p.Ltv)(s.current).selectAll("*").remove();const e={top:40,right:180,bottom:60,left:70},i=700-e.left-e.right,l=350-e.top-e.bottom,r=(0,p.Ltv)(s.current).append("svg").attr("width",i+e.left+e.right).attr("height",l+e.top+e.bottom).append("g").attr("transform","translate(".concat(e.left,",").concat(e.top,")")),c=["protein","carbs","fat"],d=[(0,a.A)({name:"Current Intake"},n),{name:"Recommended",protein:o.protein.value,carbs:o.carbs.value,fat:o.fat.value}],m={protein:"#22c55e",carbs:"#3b82f6",fat:"#f59e0b"},u=(0,p.WH)().domain(d.map((e=>e.name))).range([0,i]).padding(.3),h=(0,p.T9B)(d,(e=>e.protein+e.carbs+e.fat)),g=(0,p.m4Y)().domain([0,1.1*h]).range([l,0]);r.append("g").attr("transform","translate(0,".concat(l,")")).call((0,p.l78)(u)).selectAll("text").attr("font-size","12px").attr("font-weight",(e=>"Recommended"===e?"bold":"normal")),r.append("g").call((0,p.V4s)(g).ticks(5)).selectAll("text").attr("font-size","12px"),r.append("text").attr("transform","rotate(-90)").attr("y",20-e.left).attr("x",-l/2).attr("font-size","14px").attr("text-anchor","middle").attr("fill","#666").text("Grams");const v=(new Date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});r.append("text").attr("x",i/2).attr("y",-e.top/2).attr("text-anchor","middle").attr("font-size","16px").attr("font-weight","bold").attr("fill","#333").text("Long COVID Macronutrient Analysis - ".concat(v)),d.forEach((e=>{let t=0;e.stackedData=c.map((n=>({nutrient:n,y0:t,y1:t+=e[n]||0})))}));const f=(0,p.Ltv)("body").append("div").attr("class","d3-tooltip").style("position","absolute").style("background-color","white").style("border","1px solid #ddd").style("border-radius","4px").style("padding","8px").style("font-size","12px").style("pointer-events","none").style("opacity",0).style("box-shadow","0 2px 4px rgba(0,0,0,0.1)").style("z-index",100);r.selectAll(".bar-group").data(d).join("g").attr("class","bar-group").attr("transform",(e=>"translate(".concat(u(e.name),",0)"))).selectAll("rect").data((e=>e.stackedData)).join("rect").attr("width",u.bandwidth()).attr("y",(e=>g(e.y1))).attr("height",(e=>g(e.y0)-g(e.y1))).attr("fill",(e=>m[e.nutrient])).attr("stroke","white").attr("stroke-width",1).on("mouseover",(function(e,t){const n=(0,p.Ltv)(this.parentNode).datum(),a=n[t.nutrient].toFixed(1),i=(n[t.nutrient]/(n.protein+n.carbs+n.fat)*100).toFixed(1),s="fat"===t.nutrient?9:4,l=(n[t.nutrient]*s).toFixed(0),r="Recommended"===n.name&&o[t.nutrient].covidNote?'<br><span style="color:#6366f1;font-style:italic">'.concat(o[t.nutrient].covidNote,"</span>"):"";f.style("opacity",1).html('\n              <div style="font-weight:bold;text-transform:capitalize;color:'.concat(m[t.nutrient],'">').concat(t.nutrient,'</div>\n              <div style="margin:4px 0">\n                <b>Amount:</b> ').concat(a,"g\n                <br><b>Percentage:</b> ").concat(i,"%\n                <br><b>Calories:</b> ").concat(l," kcal\n                ").concat(r,"\n              </div>\n            ")).style("left",e.pageX+10+"px").style("top",e.pageY-28+"px"),(0,p.Ltv)(this).attr("stroke","#333").attr("stroke-width",2)})).on("mouseout",(function(){f.style("opacity",0),(0,p.Ltv)(this).attr("stroke","white").attr("stroke-width",1)}));const x=r.append("g").attr("class","legend").attr("transform","translate(".concat(i+20,", 0)"));c.forEach(((e,t)=>{const n=x.append("g").attr("transform","translate(0, ".concat(25*t,")"));n.append("rect").attr("width",15).attr("height",15).attr("fill",m[e]),n.append("text").attr("x",24).attr("y",12).attr("text-anchor","start").style("text-transform","capitalize").style("font-size","14px").text(e)})),null!==t&&void 0!==t&&t.covid_condition&&r.append("text").attr("x",i/2).attr("y",l+40).attr("text-anchor","middle").attr("font-size","12px").attr("font-style","italic").attr("fill","#6366f1").text("Note: RDA values adjusted for Long COVID recovery needs");const y=e=>(4*e.protein+4*e.carbs+9*e.fat).toFixed(0),j=r.append("g").attr("class","calorie-info").attr("transform","translate(".concat(i+20,", ").concat(25*c.length+20,")"));return j.append("text").attr("font-size","14px").attr("font-weight","bold").text("Total Calories:"),j.append("text").attr("y",25).attr("font-size","14px").text("Intake: ".concat(y(n)," kcal")),j.append("text").attr("y",50).attr("font-size","14px").text("Recommended: ".concat(o.calories.value.toFixed(0)," kcal")),()=>{(0,p.Ltv)(".d3-tooltip").remove()}}catch(e){console.error("Error rendering MacronutrientChart:",e)}}),[s,o,n,t]),(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)("div",{ref:s,className:"macro-chart mx-auto overflow-visible",style:{minHeight:"350px"}})})}const b=e=>{let{data:t,maxPercent:n}=e;const a=Math.min(100,t.rawValue/t.rda*100),i=Math.round(t.rawValue/t.rda*100),s=Math.min(100,100),o=(l=a)>=100?"#4CAF50":l>=70?"#8BC34A":l>=50?"#FFC107":l>=30?"#FF9800":"#F44336";var l;return(0,r.jsxs)("div",{className:"bullet-chart",children:[(0,r.jsxs)("div",{className:"bullet-chart-header",children:[(0,r.jsxs)("div",{className:"bullet-chart-title",children:[(0,r.jsx)("span",{className:"nutrient-name",children:t.name}),t.isAdjusted&&(0,r.jsx)("span",{className:"adjusted-badge",children:"Adjusted"})]}),(0,r.jsxs)("div",{className:"bullet-chart-values",children:[t.rawValue.toFixed(2)," / ",t.rda," ",t.unit,(0,r.jsxs)("span",{className:"bullet-chart-percentage",style:{color:o},children:["(",i,"%)"]})]})]}),(0,r.jsxs)("div",{className:"bullet-chart-track",children:[(0,r.jsx)("div",{className:"threshold-marker",style:{left:"70%"}}),(0,r.jsx)("div",{className:"actual-value-bar",style:{width:"".concat(a,"%"),backgroundColor:o}}),(0,r.jsx)("div",{className:"target-line",style:{left:"".concat(s,"%")}})]})]})};function N(e){let{data:t,userData:n}=e;const[s,o]=(0,i.useState)(n||{}),[l,c]=(0,i.useState)([]),[d,m]=(0,i.useState)([]),[u]=(0,i.useState)(t&&Object.keys(t).length>0?function(e,t){console.log("=== FIXED ensureCompleteNutrientData ==="),console.log("Input intakeData:",e);const n={};for(const a in t){if(!t.hasOwnProperty(a))continue;const i=t[a];if(i&&void 0!==i.value&&i.unit)if(e&&void 0!==e[a]){const t=e[a];if("object"===typeof t&&null!==t&&void 0!==t.value&&void 0!==t.unit){let e=parseFloat(t.value)||0,s=t.unit;s!==i.unit&&("mcg"===s&&"mg"===i.unit?(e/=1e3,s="mg"):"mg"===s&&"mcg"===i.unit?(e*=1e3,s="mcg"):"g"===s&&"mg"===i.unit?(e*=1e3,s="mg"):"IU"===s&&"vitamin_a"===a&&"mcg"===i.unit?(e*=.3,s="mcg"):"IU"===s&&"vitamin_d"===a&&"mcg"===i.unit&&(e*=.025,s="mcg"),console.log("Converted ".concat(a,": ").concat(t.value," ").concat(t.unit," \u2192 ").concat(e," ").concat(s))),n[a]={value:e,unit:s}}else if("number"===typeof t)n[a]={value:t,unit:i.unit};else if("string"===typeof t){const e=parseFloat(t)||0;n[a]={value:e,unit:i.unit}}else console.warn("Unexpected intake format for ".concat(a,":"),t),n[a]={value:0,unit:i.unit}}else n[a]={value:0,unit:i.unit};else console.warn("Invalid RDA data for ".concat(a,":"),i)}return console.log("Output completeIntakeData:",n),console.log("=== END FIXED ensureCompleteNutrientData ===\n"),n}(t,y):{}),[,h]=(0,i.useState)({}),[g,p]=(0,i.useState)("all"),[v,f]=(0,i.useState)(!0),[x,j]=(0,i.useState)("all"),N=(0,i.useCallback)((e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"mild":return 1.1;case"moderate":return 1.3;case"severe":return 1.5;case"very severe":return 1.8;default:return 1}}),[]),C=(0,i.useCallback)(((e,t)=>{console.log("=== FIXED processNutrientData ==="),console.log("Processing",Object.keys(t).length,"nutrients");const n=[];for(const i in t){if(!t.hasOwnProperty(i))continue;const a=t[i];if(!a||void 0===a.value||!a.unit){console.warn("Skipping ".concat(i,": Invalid RDA info"),a);continue}const s=e[i];let o=0;s&&"object"===typeof s&&void 0!==s.value&&(o=parseFloat(s.value)||0),console.log("intakeValue",o);const l=a.value>0?o/a.value*100:0;l>1e4&&console.warn("Extremely high percentage for ".concat(i,": ").concat(l,"% - possible unit error"));const r=i.replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase())),c=i.includes("vitamin")?"vitamins":"minerals",d={key:i,name:r,value:parseFloat(l.toFixed(10)),rawValue:o,unit:a.unit,rda:a.value,rdaUnit:a.unit,isAdjustedRDA:a.isAdjusted||!1,percentOfRDA:parseFloat(l.toFixed(10)),category:c};console.log("".concat(r,": ").concat(o).concat(a.unit," / ").concat(a.value).concat(a.unit," = ").concat(l.toFixed(1),"%")),n.push(d)}const a=n.sort(((e,t)=>e.percentOfRDA-t.percentOfRDA));return console.log("=== PROCESSING SUMMARY ==="),console.log("Total nutrients processed:",a.length),console.log("Deficient (<70%):",a.filter((e=>e.value<70)).length),console.log("Optimal (\u2265100%):",a.filter((e=>e.value>=100)).length),a}),[]),w=(0,i.useCallback)((e=>{let t=[...e];"all"!==x&&(t=t.filter((e=>e.category===x))),"deficient"===g?(t=t.filter((e=>e.value<70)),t.sort(((e,t)=>e.value-t.value))):"optimal"===g?(t=t.filter((e=>e.value>=100)),t.sort(((e,t)=>t.value-e.value))):t.sort(((e,t)=>e.value-t.value)),c(t)}),[g,x]),k=(0,i.useCallback)(((e,t)=>{if(!e||0===Object.keys(e).length)return console.error("baseRDAData_ is empty or invalid!"),{};const n=JSON.parse(JSON.stringify(e));return Object.keys(n).forEach((i=>{var s;if(!n[i]||"number"!==typeof n[i].value)return console.error("Invalid data structure for ".concat(i)),void(n[i]={value:0,unit:(null===(s=n[i])||void 0===s?void 0:s.unit)||"mg",isAdjusted:!1});let o=n[i].value;if(null!==t&&void 0!==t&&t.gender&&"female"===t.gender.toLowerCase()){o*=n[i].femaleAdjust||1}if(null!==t&&void 0!==t&&t.age){let e=1;t.age>=70?("vitamin_d"===i&&(e=1.2),"vitamin_b12"===i&&(e=1.1),"calcium"===i&&(e=1.15)):t.age>=50?("vitamin_d"===i&&(e=1.1),"vitamin_b12"===i&&(e=1.05)):t.age<=18&&("calcium"===i&&(e=1.15),"iron"===i&&(e=1.1)),1!==e&&(o*=e)}const l=(null===t||void 0===t?void 0:t.covid_severity)||(null===t||void 0===t?void 0:t.longCovidSeverity);if(l&&"None"!==l&&null!==l&&void 0!==l){const e=N(l);if(["vitamin_c","vitamin_d","zinc","selenium"].includes(i)){o*=Math.min(1.5*e,2.5)}else if(["vitamin_a","vitamin_e","vitamin_b6","vitamin_b12","folate","iron"].includes(i)){o*=Math.min(1.3*e,2)}else if(["magnesium","copper","vitamin_b1","vitamin_b2","vitamin_b3"].includes(i)){o*=Math.min(1.1*e,1.5)}}(isNaN(o)||!isFinite(o)||o<=0)&&(console.error("Invalid final value for ".concat(i,": ").concat(o,", resetting to base")),o=n[i].value);const r=Math.round(10*o)/10;n[i]=(0,a.A)((0,a.A)({},n[i]),{},{value:r,isAdjusted:r!==e[i].value})})),n}),[N]),S=e=>e>=100?{label:"Optimal",color:"#4CAF50"}:e>=70?{label:"Good",color:"#8BC34A"}:e>=50?{label:"Moderate",color:"#FFC107"}:e>=30?{label:"Low",color:"#FF9800"}:{label:"Very Low",color:"#F44336"},A=e=>{const t={};for(const a in y)t[a.replace(/_/g," ")]=y[a].description;const n=t[e.toLowerCase()];if(n)return n;for(const a in t)if(e.toLowerCase().includes(a))return t[a];return""};(0,i.useEffect)((()=>{f(!0);const e=setTimeout((()=>{try{const e=k(y,s);if(!e||0===Object.keys(e).length)return console.error("Failed to calculate RDA values"),void f(!1);h(e);const t=C(u,e);m(t),w(t)}catch(e){console.error("Error in MicronutrientChart useEffect:",e)}finally{f(!1)}}),500);return()=>clearTimeout(e)}),[s,u,k,C,w]),(0,i.useEffect)((()=>{d.length>0&&w(d)}),[g,x,d,w]);const F=()=>{var e,t;const n=[null,"mild","moderate","severe","very severe"],i=(null===(e=s.covid_severity)||void 0===e?void 0:e.toLowerCase())||(null===(t=s.longCovidSeverity)||void 0===t?void 0:t.toLowerCase())||null,l=n.indexOf(i),r=n[(l+1)%n.length],c=(0,a.A)((0,a.A)({},s),{},{covid_severity:r,longCovidSeverity:r,hasLongCovid:null!==r});null===r&&(delete c.covid_severity,delete c.longCovidSeverity,c.hasLongCovid=!1),o(c)},D=()=>{const e=s.covid_severity||s.longCovidSeverity;return e&&null!==e&&"None"!==e?e.charAt(0).toUpperCase()+e.slice(1):"None"},_=e=>{p(e)},L=e=>{j(e)};if(v)return(0,r.jsx)("div",{className:"loading-container",children:(0,r.jsxs)("div",{className:"loading-indicator",children:[(0,r.jsx)("div",{className:"spinner"}),(0,r.jsx)("p",{className:"loading-text",children:"Loading personalized micronutrient data..."})]})});const E=d.filter((e=>e.value<70)).length;return t&&0!==Object.keys(t).length||n&&0!==Object.keys(n).length?t&&0!==Object.keys(t).length&&0!==d.length?(0,r.jsxs)("div",{className:"micronutrient-chart-container",children:[(0,r.jsxs)("div",{className:"chart-card",children:[(0,r.jsxs)("div",{className:"chart-header",children:[(0,r.jsx)("h2",{className:"chart-title",children:"Micronutrient Status"}),(0,r.jsxs)("div",{className:"display-mode-buttons",children:[(0,r.jsxs)("button",{onClick:()=>_("all"),className:"mode-button ".concat("all"===g?"mode-button-active":""),children:["All (",d.length,")"]}),(0,r.jsxs)("button",{onClick:()=>_("deficient"),className:"mode-button ".concat("deficient"===g?"mode-button-deficient":""),children:["Deficient (",E,")"]}),(0,r.jsxs)("button",{onClick:()=>_("optimal"),className:"mode-button ".concat("optimal"===g?"mode-button-optimal":""),children:["Optimal (",d.filter((e=>e.percentOfRDA>=100)).length,")"]})]})]}),(0,r.jsxs)("div",{className:"category-filter",children:[(0,r.jsx)("button",{onClick:()=>L("all"),className:"category-button ".concat("all"===x?"category-button-active":""),children:"All Nutrients"}),(0,r.jsx)("button",{onClick:()=>L("vitamins"),className:"category-button ".concat("vitamins"===x?"category-button-active":""),children:"Vitamins"}),(0,r.jsx)("button",{onClick:()=>L("minerals"),className:"category-button ".concat("minerals"===x?"category-button-active":""),children:"Minerals"})]}),E>0&&(0,r.jsx)("div",{className:"deficiency-alert",children:(0,r.jsxs)("p",{className:"deficiency-message",children:[E," ",1===E?"nutrient is":"nutrients are"," below recommended levels."]})}),s.covid_severity&&"None"!==D()&&(0,r.jsxs)("div",{className:"covid-alert ".concat((e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"mild":return"covid-severity-mild";case"moderate":return"covid-severity-moderate";case"severe":return"covid-severity-severe";case"very severe":return"covid-severity-very-severe";default:return"covid-severity-unknown"}})(s.covid_severity)),children:[(0,r.jsxs)("p",{className:"covid-title",children:["Long COVID Condition - ",D()," Severity"]}),(0,r.jsx)("p",{className:"covid-description",children:"Recommended values have been adjusted for immune system support"})]}),(0,r.jsx)("div",{className:"chart-content",children:0===l.length&&d.length>0?(0,r.jsxs)("div",{className:"no-filter-results",children:[(0,r.jsx)("div",{className:"no-results-icon",children:"\ud83c\udfaf"}),(0,r.jsx)("h3",{className:"no-results-title",children:"Great news!"}),(0,r.jsxs)("p",{className:"no-results-message",children:["You don't have any ",(()=>{const e="deficient"===g?"below 70% RDA":"optimal"===g?"at 100%+ RDA":"";let t="vitamins"===x?"vitamins":"minerals"===x?"minerals":"nutrients";return e&&(t+=" ".concat(e)),t.trim()})()," to display.","deficient"===g&&" This means your nutrient levels are doing well in this category!","optimal"===g&&" Try logging more diverse meals to reach optimal levels."]}),(0,r.jsx)("p",{className:"no-results-suggestion",children:'Try selecting "All" to see your complete nutrient profile.'})]}):l.map((e=>(0,r.jsx)(b,{data:e,maxPercent:150,getNutrientStatus:S,getNutrientInfo:A},e.key)))}),(0,r.jsxs)("div",{className:"chart-legend",children:[(0,r.jsxs)("div",{className:"legend-item",children:[(0,r.jsx)("div",{className:"legend-color legend-optimal"}),(0,r.jsx)("span",{className:"legend-text",children:"\u2265 100% (Optimal)"})]}),(0,r.jsxs)("div",{className:"legend-item",children:[(0,r.jsx)("div",{className:"legend-color legend-good"}),(0,r.jsx)("span",{className:"legend-text",children:"70-99% (Good)"})]}),(0,r.jsxs)("div",{className:"legend-item",children:[(0,r.jsx)("div",{className:"legend-color legend-moderate"}),(0,r.jsx)("span",{className:"legend-text",children:"50-69% (Moderate)"})]}),(0,r.jsxs)("div",{className:"legend-item",children:[(0,r.jsx)("div",{className:"legend-color legend-low"}),(0,r.jsx)("span",{className:"legend-text",children:"30-49% (Low)"})]}),(0,r.jsxs)("div",{className:"legend-item",children:[(0,r.jsx)("div",{className:"legend-color legend-very-low"}),(0,r.jsx)("span",{className:"legend-text",children:"0-29% (Very Low)"})]}),(0,r.jsxs)("div",{className:"legend-item",children:[(0,r.jsx)("div",{className:"legend-target"}),(0,r.jsx)("span",{className:"legend-text",children:"Target (100% RDA)"})]}),(0,r.jsxs)("div",{className:"legend-item",children:[(0,r.jsx)("div",{className:"legend-threshold"}),(0,r.jsx)("span",{className:"legend-text",children:"Deficiency Threshold (70%)"})]})]})]}),(0,r.jsxs)("div",{className:"profile-card",children:[(0,r.jsx)("h3",{className:"profile-title",children:"User Profile"}),(0,r.jsxs)("div",{className:"profile-grid",children:[(0,r.jsxs)("div",{className:"profile-item",children:[(0,r.jsx)("p",{className:"profile-label",children:"Age"}),(0,r.jsxs)("p",{className:"profile-value",children:[(null===s||void 0===s?void 0:s.age)||"Not specified"," years"]})]}),(0,r.jsxs)("div",{className:"profile-item",children:[(0,r.jsx)("p",{className:"profile-label",children:"Gender"}),(0,r.jsx)("p",{className:"profile-value",children:null!==s&&void 0!==s&&s.gender?s.gender.charAt(0).toUpperCase()+s.gender.slice(1):"Not specified"})]}),(0,r.jsxs)("div",{className:"profile-item",children:[(0,r.jsx)("p",{className:"profile-label",children:"BMI"}),(0,r.jsx)("p",{className:"profile-value",children:null!==s&&void 0!==s&&s.weight&&null!==s&&void 0!==s&&s.height?(s.weight/Math.pow(s.height/100,2)).toFixed(1):"N/A"})]}),(0,r.jsxs)("div",{className:"profile-item",children:[(0,r.jsx)("p",{className:"profile-label",children:"Activity Level"}),(0,r.jsx)("p",{className:"profile-value",children:(null===s||void 0===s?void 0:s.activity_level)||"Not specified"})]}),(0,r.jsxs)("div",{className:"profile-item",children:[(0,r.jsx)("p",{className:"profile-label",children:"Medical Conditions"}),(0,r.jsx)("p",{className:"profile-value",children:null!==s&&void 0!==s&&s.medical_conditions&&s.medical_conditions.length>0?s.medical_conditions.map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(", "):"None"})]}),(0,r.jsxs)("div",{className:"profile-item",children:[(0,r.jsx)("p",{className:"profile-label",children:"COVID Status"}),(0,r.jsxs)("button",{onClick:F,className:"covid-toggle-button",style:{padding:"8px 12px",backgroundColor:"#e3f2fd",border:"2px solid #2196f3",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#1976d2",transition:"all 0.2s ease",minWidth:"120px"},onMouseEnter:e=>{e.target.style.backgroundColor="#bbdefb",e.target.style.transform="scale(1.02)"},onMouseLeave:e=>{e.target.style.backgroundColor="#e3f2fd",e.target.style.transform="scale(1)"},children:[D()," (Click to change)"]})]})]})]})]}):(0,r.jsxs)("div",{className:"micronutrient-chart-container",children:[(0,r.jsxs)("div",{className:"chart-card",children:[(0,r.jsx)("div",{className:"chart-header",children:(0,r.jsx)("h2",{className:"chart-title",children:"Micronutrient Status"})}),(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("div",{className:"empty-state-icon",children:"\ud83d\udcca"}),(0,r.jsx)("h3",{className:"empty-state-title",children:"No Micronutrient Data Available"}),(0,r.jsx)("p",{className:"empty-state-description",children:"Once you log some meals, we'll analyze your nutrient intake and show your personalized micronutrient status here."})]})]}),(0,r.jsxs)("div",{className:"profile-card",children:[(0,r.jsx)("h3",{className:"profile-title",children:"User Profile"}),(0,r.jsxs)("div",{className:"profile-grid",children:[(0,r.jsxs)("div",{className:"profile-item",children:[(0,r.jsx)("p",{className:"profile-label",children:"Age"}),(0,r.jsxs)("p",{className:"profile-value",children:[(null===s||void 0===s?void 0:s.age)||"Not specified"," years"]})]}),(0,r.jsxs)("div",{className:"profile-item",children:[(0,r.jsx)("p",{className:"profile-label",children:"Gender"}),(0,r.jsx)("p",{className:"profile-value",children:null!==s&&void 0!==s&&s.gender?s.gender.charAt(0).toUpperCase()+s.gender.slice(1):"Not specified"})]}),(0,r.jsxs)("div",{className:"profile-item",children:[(0,r.jsx)("p",{className:"profile-label",children:"BMI"}),(0,r.jsx)("p",{className:"profile-value",children:null!==s&&void 0!==s&&s.weight&&null!==s&&void 0!==s&&s.height?(s.weight/Math.pow(s.height/100,2)).toFixed(1):"N/A"})]}),(0,r.jsxs)("div",{className:"profile-item",children:[(0,r.jsx)("p",{className:"profile-label",children:"Activity Level"}),(0,r.jsx)("p",{className:"profile-value",children:(null===s||void 0===s?void 0:s.activity_level)||"Not specified"})]}),(0,r.jsxs)("div",{className:"profile-item",children:[(0,r.jsx)("p",{className:"profile-label",children:"Medical Conditions"}),(0,r.jsx)("p",{className:"profile-value",children:null!==s&&void 0!==s&&s.medical_conditions&&s.medical_conditions.length>0?s.medical_conditions.map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(", "):"None"})]}),(0,r.jsxs)("div",{className:"profile-item",children:[(0,r.jsx)("p",{className:"profile-label",children:"COVID Status"}),(0,r.jsxs)("button",{onClick:F,className:"covid-toggle-button",style:{padding:"8px 12px",backgroundColor:"#e3f2fd",border:"2px solid #2196f3",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#1976d2",transition:"all 0.2s ease",minWidth:"120px"},onMouseEnter:e=>{e.target.style.backgroundColor="#bbdefb",e.target.style.transform="scale(1.02)"},onMouseLeave:e=>{e.target.style.backgroundColor="#e3f2fd",e.target.style.transform="scale(1)"},children:[D()," (Click to change)"]})]})]})]})]}):(0,r.jsx)("div",{className:"micronutrient-chart-container",children:(0,r.jsxs)("div",{className:"chart-card",children:[(0,r.jsx)("div",{className:"chart-header",children:(0,r.jsx)("h2",{className:"chart-title",children:"Micronutrient Status"})}),(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("div",{className:"empty-state-icon",children:"\ud83d\udcca"}),(0,r.jsx)("h3",{className:"empty-state-title",children:"No Data Available"}),(0,r.jsx)("p",{className:"empty-state-description",children:"Please set up your profile and log some meals to see your personalized micronutrient analysis."})]})]})})}function C(e){let{data:t,userData:n,foodDatabase:s}=e;const o=(0,i.useRef)(null),[l,c]=(0,i.useState)([]);return(0,i.useEffect)((()=>{if(!t||0===t.length)return;const e=new Date,i=new Date;i.setDate(e.getDate()-7);const s=x(i),o=t.filter((e=>{try{return t=e.date,n=s,f(t)>=f(n)}catch(a){return console.warn("Error parsing date:",e.date),!1}var t,n})).map(((e,t)=>{try{console.log("Calculating efficiency for ".concat(e.name," using enhanced function"));const t=v(e,n),i=t&&t>0?t:e.efficiency||e.metabolicEfficiency||80;return console.log("Final efficiency for ".concat(e.name,": ").concat(i)),(0,a.A)((0,a.A)({},e),{},{originalEfficiency:e.efficiency||e.metabolicEfficiency||80,efficiency:i,actualEnergy:Math.round(e.calories*(i/100)),wastedEnergy:Math.round(e.calories*((100-i)/100))})}catch(i){console.warn("Error processing meal ".concat(t,":"),i);const n=e.efficiency||e.metabolicEfficiency||80;return(0,a.A)((0,a.A)({},e),{},{efficiency:n,actualEnergy:Math.round(e.calories*(n/100)),wastedEnergy:Math.round(e.calories*((100-n)/100))})}})).filter((e=>"Pre-workout"!==e.mealType&&"Post-workout"!==e.mealType));console.log("ProcessedData with consistent efficiency:",o),c(o)}),[t,n,s]),(0,i.useEffect)((()=>{if(!o.current||!l||0===l.length)return;(0,p.Ltv)(o.current).selectAll("*").remove();const e=60,t=20,n=50,i=50,s=900-i-t,r=450-e-n,c=(0,p.Ltv)(o.current).append("svg").attr("width",s+i+t).attr("height",r+e+n).append("g").attr("transform","translate(".concat(i,",").concat(e,")"));c.append("text").attr("x",s/2).attr("y",-30).attr("text-anchor","middle").style("font-size","18px").style("font-weight","bold").text("Enhanced Metabolic Efficiency Chart"),c.append("text").attr("x",s/2).attr("y",-10).attr("text-anchor","middle").style("font-size","14px").style("font-style","italic").text("Optimized for Long COVID energy management");const d=(0,p.Ltv)("body").append("div").attr("class","chart-tooltip").style("position","absolute").style("visibility","hidden").style("background-color","white").style("border","1px solid #ddd").style("border-radius","5px").style("padding","12px").style("font-size","14px").style("box-shadow","0 3px 14px rgba(0,0,0,0.25)").style("z-index","10").style("max-width","300px"),m=[],u=new Date;for(let a=6;a>=0;a--){const e=new Date;e.setDate(u.getDate()-a);const t=x(e);m.push(t)}const h=[],g=(0,p.Os0)(l,(e=>e.date)),v=["Breakfast","Morning Snack","Lunch","Afternoon Snack","Dinner","Late Night Snack"];m.forEach((e=>{const t=g.get(e)||[];if(t.length>0){const n=(0,p.Os0)(t,(e=>e.mealType));v.forEach((t=>{const a=n.get(t);if(a&&a.length>0){const n=(0,p.czq)(a,(e=>e.calories)),i=a.reduce(((e,t)=>e+(t.efficiency||0)*(n>0?t.calories/n:0)),0),s=(0,p.czq)(a,(e=>e.actualEnergy||e.calories*(e.efficiency/100))),o=n-s;h.push({date:e,mealType:t,time:a[0].time,name:"".concat(t," (").concat(a.length," items)"),efficiency:Math.round(i),calories:n,actualEnergy:s,wastedEnergy:o,originalMeals:a,mealOrder:v.indexOf(t)})}}))}}));const f=[...h].sort(((e,t)=>e.date!==t.date?e.date.localeCompare(t.date):e.mealOrder-t.mealOrder)),y=(0,p.WH)().domain(m).range([0,s]).padding(.2),j=(0,p.WH)().domain(v).range([0,y.bandwidth()]).padding(.1),b=(0,p.T9B)(h,(e=>e.calories))||1e3,N=(0,p.m4Y)().domain([0,b]).range([r,0]),C=(0,p.m4Y)().domain([0,100]).range([r,0]);c.append("g").attr("transform","translate(0,".concat(r,")")).call((0,p.l78)(y).tickFormat((e=>{const t=e.split("-");return"".concat(parseInt(t[1]),"/").concat(parseInt(t[2]))}))).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-45)"),c.append("g").call((0,p.V4s)(N)).append("text").attr("transform","rotate(-90)").attr("y",-50).attr("x",-r/2).attr("text-anchor","middle").style("fill","#000").text("Calories"),c.append("g").attr("transform","translate(".concat(s,", 0)")).call((0,p.eH3)(C)).append("text").attr("transform","rotate(-90)").attr("y",50).attr("x",-r/2).attr("text-anchor","middle").style("fill","#000").text("Enhanced Efficiency (%)");const w={Breakfast:"#DC2626","Morning Snack":"#EA580C",Lunch:"#16A34A","Afternoon Snack":"#0891B2",Dinner:"#7C3AED","Late Night Snack":"#BE185D"};if(h.forEach((e=>{const t=w[e.mealType]||"#999999",n=y(e.date)+j(e.mealType),a=j.bandwidth();c.append("rect").attr("class","actual-energy-bar").attr("x",n).attr("y",N(e.actualEnergy)).attr("width",a).attr("height",r-N(e.actualEnergy)).attr("fill",t).attr("opacity",.9).attr("stroke","#333").attr("stroke-width",1).on("mouseover",(function(t){(0,p.Ltv)(this).attr("opacity",.7),d.style("visibility","visible").html('\n              <div style="font-weight:bold;margin-bottom:10px;font-size:15px;">'.concat(e.date," - ").concat(e.mealType,'</div>\n              <div style="margin-bottom:6px;">Total Calories: ').concat(Math.round(e.calories),'</div>\n              <div style="margin-bottom:6px;"><strong>Enhanced Efficiency: ').concat(e.efficiency,'%</strong></div>\n              <div style="margin-bottom:6px;">Usable Energy: ').concat(Math.round(e.actualEnergy),' cal</div>\n              <div style="margin-bottom:12px;">Energy Lost: ').concat(Math.round(e.wastedEnergy),' cal</div>\n              <div style="font-weight:bold;margin-bottom:5px;">Individual Items:</div>\n              <ul style="margin-top:0;padding-left:20px;">\n                ').concat(e.originalMeals.map((e=>"\n                  <li>".concat(e.name," - ").concat(e.calories," cal (").concat(Math.round(e.efficiency),"% efficient)</li>\n                "))).join(""),"\n              </ul>\n            ")).style("left","".concat(t.pageX+15,"px")).style("top","".concat(t.pageY-10,"px"))})).on("mouseout",(function(){(0,p.Ltv)(this).attr("opacity",.9),d.style("visibility","hidden")})),c.append("rect").attr("class","potential-energy-bar").attr("x",n).attr("y",N(e.calories)).attr("width",a).attr("height",N(e.actualEnergy)-N(e.calories)).attr("fill",t).attr("opacity",.3).attr("stroke","#333").attr("stroke-width",1).attr("stroke-dasharray","3,3")})),f.length>0){const e=[...f.map(((e,t)=>{const n=y(e.date)+j(e.mealType)+j.bandwidth()/2;return(0,a.A)((0,a.A)({},e),{},{xPos:n,chronologicalIndex:t})}))].sort(((e,t)=>e.xPos-t.xPos)),t=(0,p.n8j)().x((e=>e.xPos)).y((e=>C(e.efficiency))).defined((e=>null!=e.efficiency&&!isNaN(e.efficiency))).curve(p.nVG);c.append("path").datum(e).attr("fill","none").attr("stroke","grey").attr("stroke-width",3).attr("d",t),c.selectAll(".efficiency-point").data(e).enter().append("circle").attr("class","efficiency-point").attr("cx",(e=>e.xPos)).attr("cy",(e=>C(e.efficiency))).attr("r",5).attr("fill","grey").attr("stroke","#333").attr("stroke-width",1).on("mouseover",(function(e,t){(0,p.Ltv)(this).attr("r",8),d.style("visibility","visible").html('\n              <div style="font-weight:bold;font-size:16px;">'.concat(t.mealType," - ").concat(t.time,'</div>\n              <div style="font-weight:bold;font-size:14px;">').concat(t.date,"</div>\n              <div>Enhanced Efficiency: <strong>").concat(t.efficiency,'%</strong></div>\n              <div style="margin-top:6px">Calculated using enhanced Long COVID algorithms</div>\n            ')).style("left","".concat(e.pageX+15,"px")).style("top","".concat(e.pageY-10,"px"))})).on("mouseout",(function(){(0,p.Ltv)(this).attr("r",5),d.style("visibility","hidden")}))}const k=r+100;c.append("line").attr("x1",10).attr("x2",40).attr("y1",k).attr("y2",k).attr("stroke","grey").attr("stroke-width",3),c.append("circle").attr("cx",25).attr("cy",k).attr("r",5).attr("fill","grey").attr("stroke","#333").attr("stroke-width",1),c.append("text").attr("x",50).attr("y",k+4).style("font-size","12px").text("Enhanced Efficiency (%)");const S=[{label:"Usable Energy",color:"#DC2626",opacity:.9},{label:"Energy Lost",color:"#DC2626",opacity:.3}];c.selectAll(".legend-rect").data(S).enter().append("rect").attr("x",200).attr("y",((e,t)=>k-10+20*t)).attr("width",15).attr("height",15).attr("fill",(e=>e.color)).attr("opacity",(e=>e.opacity)).attr("stroke","#333").attr("stroke-width",1),c.selectAll(".legend-text").data(S).enter().append("text").attr("x",225).attr("y",((e,t)=>k+2+20*t)).style("font-size","12px").text((e=>e.label));const A=Object.entries(w).map((e=>{let[t,n]=e;return{type:t,color:n}}));return c.selectAll(".meal-type-rect").data(A).enter().append("rect").attr("x",((e,t)=>400+140*Math.floor(t/3))).attr("y",((e,t)=>k-10+t%3*20)).attr("width",15).attr("height",15).attr("fill",(e=>e.color)).attr("stroke","#333").attr("stroke-width",1),c.selectAll(".meal-type-text").data(A).enter().append("text").attr("x",((e,t)=>425+140*Math.floor(t/3))).attr("y",((e,t)=>k+2+t%3*20)).style("font-size","12px").text((e=>e.type)),()=>{(0,p.Ltv)(".chart-tooltip").remove()}}),[o,l,n]),l&&0!==l.length?(0,r.jsxs)("div",{style:{width:"100%",minHeight:"900px",display:"flex",flexDirection:"column"},children:[(0,r.jsx)("div",{ref:o,className:"efficiency-chart",style:{height:"600px",width:"100%",overflow:"visible",flexShrink:0}}),(0,r.jsxs)("div",{style:{marginTop:"40px",padding:"25px",backgroundColor:"#f8f9fa",borderRadius:"8px",width:"100%",boxSizing:"border-box",flexShrink:0,border:"1px solid #dee2e6"},children:[(0,r.jsx)("h4",{style:{marginTop:"0",marginBottom:"20px",fontSize:"20px",fontWeight:"bold",color:"#333"},children:"Enhanced Metabolic Efficiency"}),(0,r.jsx)("p",{style:{marginBottom:"20px",lineHeight:"1.6",fontSize:"16px",color:"#555"},children:"This enhanced chart uses advanced algorithms that take into account Long COVID severity, meal timing, macronutrient balance, and individual factors to provide more accurate efficiency calculations for energy management. The efficiency line follows proper chronological order."}),(0,r.jsxs)("div",{style:{marginTop:"20px"},children:[(0,r.jsx)("strong",{style:{fontSize:"18px",color:"#333"},children:"Enhanced Features:"}),(0,r.jsxs)("ul",{style:{marginTop:"15px",paddingLeft:"30px",lineHeight:"1.8",fontSize:"15px",color:"#555"},children:[(0,r.jsx)("li",{style:{marginBottom:"8px"},children:"Long COVID severity adjustments (metabolic efficiency factors)"}),(0,r.jsx)("li",{style:{marginBottom:"8px"},children:"Circadian rhythm timing optimization"}),(0,r.jsx)("li",{style:{marginBottom:"8px"},children:"Macronutrient balance scoring"}),(0,r.jsx)("li",{style:{marginBottom:"8px"},children:"Anti-inflammatory food benefits/cautions"}),(0,r.jsx)("li",{style:{marginBottom:"8px"},children:"Chronologically ordered efficiency tracking"})]})]})]})]}):(0,r.jsx)("div",{className:"chart-container",style:{width:"100%",minHeight:"300px"},children:(0,r.jsx)("div",{ref:o,className:"efficiency-chart",children:(0,r.jsx)("div",{className:"placeholder",children:(0,r.jsx)("p",{children:"No meal data available for enhanced efficiency analysis."})})})})}function w(e){let{foodLog:t,userProfile:n}=e;if(!t||!Array.isArray(t))return(0,r.jsxs)("div",{className:"analysis-error",children:[(0,r.jsx)("h3",{children:"Data Error"}),(0,r.jsx)("p",{children:"Unable to load food log data. Please try refreshing the page."})]});if(!n)return(0,r.jsxs)("div",{className:"analysis-error",children:[(0,r.jsx)("h3",{children:"Profile Error"}),(0,r.jsx)("p",{children:"User profile data is missing. Please check your account settings."})]});const a=x(new Date),i=t.length>0?t[0].date:a,s=t.filter((e=>e.date===a)),{macroSums:o,microSums:l,efficiencyData:c}=function(e){if(!e||!Array.isArray(e))return{macroSums:{},microSums:{},efficiencyData:[]};if(0===e.length)return{macroSums:{},microSums:{},efficiencyData:[]};const t=x(new Date),n=e.filter((e=>e.date===t));if(console.log("=== FIXED getChartData DEBUG ==="),0===n.length)return{macroSums:{},microSums:{},efficiencyData:e};const a=n.reduce(((e,t)=>{const n=parseFloat(t.protein)||0,a=parseFloat(t.carbs)||0,i=parseFloat(t.fat)||0,s=parseFloat(t.calories)||0;return e.protein=(e.protein||0)+n,e.carbs=(e.carbs||0)+a,e.fat=(e.fat||0)+i,e.calories=(e.calories||0)+s,console.log("Entry: ".concat(t.name," - P:").concat(n,"g C:").concat(a,"g F:").concat(i,"g Cal:").concat(s)),e}),{}),i={};return n.forEach(((e,t)=>{console.log("\n--- Processing Entry ".concat(t,": ").concat(e.name," ---")),e.micronutrients?Object.entries(e.micronutrients).forEach((e=>{let[t,n]=e;if(["protein","carbs","fat","calories","name","unit"].includes(t.toLowerCase()))return;const a=function(e){const t={b1:"vitamin_b1",B1:"vitamin_b1",thiamine:"vitamin_b1",thiamin:"vitamin_b1",b2:"vitamin_b2",B2:"vitamin_b2",riboflavin:"vitamin_b2",b3:"vitamin_b3",B3:"vitamin_b3",niacin:"vitamin_b3",b6:"vitamin_b6",B6:"vitamin_b6",pyridoxine:"vitamin_b6",b12:"vitamin_b12",B12:"vitamin_b12",cobalamin:"vitamin_b12",vit_a:"vitamin_a",vitA:"vitamin_a",retinol:"vitamin_a",vit_c:"vitamin_c",vitC:"vitamin_c",ascorbic_acid:"vitamin_c",vit_d:"vitamin_d",vitD:"vitamin_d",cholecalciferol:"vitamin_d",vit_e:"vitamin_e",vitE:"vitamin_e",tocopherol:"vitamin_e",vit_k:"vitamin_k",vitK:"vitamin_k",folic_acid:"folate",folicAcid:"folate",Iron:"iron",Calcium:"calcium",Magnesium:"magnesium",Zinc:"zinc",Selenium:"selenium",Copper:"copper",Potassium:"potassium",Phosphorus:"phosphorus",Manganese:"manganese"};if(t[e])return t[e];const n=e.toLowerCase();return t[n]?t[n]:n.replace(/[^a-z0-9]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"")}(t);console.log('Mapping: "'.concat(t,'" \u2192 "').concat(a,'"'));let s=0,o="mg";if("object"===typeof n&&null!==n){if(void 0===n.value)return void console.warn("Object format not recognized for ".concat(t,":"),n);s=parseFloat(n.value)||0,o=n.unit||"mg"}else if("number"===typeof n)s=n;else{if("string"!==typeof n)return void console.warn("Unrecognized value format for ".concat(t,":"),n);{const e=n.match(/^([\d.]+)\s*(\w+)?/);e?(s=parseFloat(e[1])||0,o=e[2]||"mg"):s=parseFloat(n)||0}}"zinc"!==a&&"selenium"!==a&&"copper"!==a||"mcg"!==o&&"\u03bcg"!==o||"zinc"!==a&&"copper"!==a||(s/=1e3,o="mg",console.log("Converted ".concat(a," from mcg to mg: ").concat(s)));const l={zinc:50,selenium:400,copper:10,iron:100,vitamin_c:2e3,vitamin_d:100,vitamin_e:50,vitamin_b6:20,vitamin_b12:100,calcium:3e3,magnesium:1e3,potassium:1e4}[a]||1e4;(s<0||s>l)&&(console.warn("Suspicious ".concat(a," value: ").concat(s," ").concat(o," (max expected: ").concat(l,") - using cautiously")),s=Math.min(Math.max(s,0),l)),i[a]||(i[a]={value:0,unit:o}),i[a].value+=s,console.log("".concat(a,": +").concat(s," ").concat(o," \u2192 Total: ").concat(i[a].value," ").concat(o))})):console.log("No micronutrients data for ".concat(e.name))})),console.log("\n=== FINAL SUMS ==="),console.log("Macros:",a),console.log("Micros:",i),Object.entries(i).forEach((e=>{let[t,n]=e;const a={zinc:100,selenium:1e3,copper:50,iron:200,vitamin_c:5e3}[t]||1e3;n.value>a&&console.warn("Unusually high ".concat(t,": ").concat(n.value," ").concat(n.unit," (threshold: ").concat(a,")"))})),console.log("=== END FIXED DEBUG ===\n"),{macroSums:a,microSums:i,efficiencyData:e}}(t);return(0,r.jsxs)("div",{className:"food-analysis-section",children:[(0,r.jsxs)("div",{className:"analysis-header",children:[(0,r.jsx)("h3",{children:"\ud83d\udcca Nutritional Analysis Dashboard"}),(0,r.jsxs)("p",{className:"analysis-date",children:["Analysis for ",i]}),(0,r.jsx)("div",{className:"analysis-summary",children:(0,r.jsxs)("span",{className:"summary-stat",children:[(0,r.jsx)("strong",{children:s.length})," meals logged today (",a,")"]})})]}),(0,r.jsxs)("div",{className:"charts-container",children:[(0,r.jsxs)("div",{className:"chart-wrapper",children:[(0,r.jsxs)("div",{className:"chart-header",children:[(0,r.jsx)("h4",{children:"\ud83c\udfaf Macronutrient Balance"}),(0,r.jsx)("p",{className:"chart-description",children:"Your protein, carbohydrate, and fat intake compared to personalized recommendations"})]}),(0,r.jsx)(j,{userData:n,userIntake:o})]}),(0,r.jsxs)("div",{className:"chart-wrapper",children:[(0,r.jsxs)("div",{className:"chart-header",children:[(0,r.jsx)("h4",{children:"\ud83d\udc8a Micronutrient Status"}),(0,r.jsx)("p",{className:"chart-description",children:"Essential vitamins and minerals as percentage of recommended daily amounts"})]}),(0,r.jsx)(N,{data:l,userData:n})]}),(0,r.jsxs)("div",{className:"chart-wrapper",children:[(0,r.jsxs)("div",{className:"chart-header",children:[(0,r.jsx)("h4",{children:"\u26a1 Metabolic Efficiency"}),(0,r.jsx)("p",{className:"chart-description",children:"How effectively your body converts food calories into usable energy"})]}),(0,r.jsx)("div",{style:{width:"100%",overflow:"visible"},children:(0,r.jsx)(C,{data:c,userData:n})})]})]})]})}const k=e=>{let{micronutrients:t={},selectedMeal:n=null}=e;const a={vitamin_c:"Vitamin C",vitamin_d:"Vitamin D",vitamin_e:"Vitamin E",vitamin_a:"Vitamin A",vitamin_k:"Vitamin K",thiamin:"B1",riboflavin:"B2",niacin:"B3",vitamin_b6:"B6",folate:"Folate",vitamin_b12:"B12",calcium:"Calcium",iron:"Iron",magnesium:"Magnesium",phosphorus:"Phosphorus",potassium:"Potassium",sodium:"Sodium",zinc:"Zinc"},i=["vitamin_c","vitamin_d","vitamin_a","vitamin_e","vitamin_k","vitamin_b12","folate","vitamin_b6","thiamin","riboflavin","niacin","calcium","iron","magnesium","zinc","potassium","phosphorus","sodium"].filter((e=>{const n=t[e];return void 0!==(null===n||void 0===n?void 0:n.value)&&parseFloat(n.value)>0&&parseFloat(n.value)<1e4}));if(0===i.length)return(0,r.jsxs)("div",{className:"micronutrient-radar-container",children:[(0,r.jsx)("h4",{children:"\ud83d\udd2c Micronutrient Profile"}),(0,r.jsxs)("div",{className:"no-micronutrients",children:[(0,r.jsx)("div",{className:"no-data-icon",children:"\ud83d\udcca"}),(0,r.jsx)("p",{children:"No micronutrient data available for this food item."}),n&&(0,r.jsx)("p",{className:"data-note",children:(0,r.jsx)("em",{children:"Select a different food or check if micronutrient data exists in the database."})})]})]});const s=i.slice(0,8),o=300,l=150,c=150,d=s.length,m=2*Math.PI/d,u=Math.max(...s.map((e=>{var n;return parseFloat((null===(n=t[e])||void 0===n?void 0:n.value)||0)}))),h=s.map(((e,t)=>{const n=t*m-Math.PI/2;return{x1:l,y1:c,x2:l+80*Math.cos(n),y2:c+80*Math.sin(n),label:a[e],labelX:l+115*Math.cos(n),labelY:c+115*Math.sin(n),key:e,angle:n}})),g=s.map(((e,n)=>{var i,s;const o=n*m-Math.PI/2,r=parseFloat((null===(i=t[e])||void 0===i?void 0:i.value)||0),d=u>0?Math.min(r/u,1):0,h=80*d;return{x:l+Math.cos(o)*h,y:c+Math.sin(o)*h,label:a[e],value:r,unit:(null===(s=t[e])||void 0===s?void 0:s.unit)||"mg",angle:o,normalizedValue:d,axisIndex:n}}));let p="";g.length>=3?p=g.map(((e,t)=>"".concat(0===t?"M":"L"," ").concat(e.x.toFixed(2)," ").concat(e.y.toFixed(2)))).join(" ")+" Z":2===g.length&&(p="M ".concat(g[0].x.toFixed(2)," ").concat(g[0].y.toFixed(2)," L ").concat(g[1].x.toFixed(2)," ").concat(g[1].y.toFixed(2)));const v=[.25,.5,.75,1].map((e=>({r:80*e,opacity:1===e?.4:.2})));return(0,r.jsxs)("div",{className:"micronutrient-radar-container",children:[(0,r.jsx)("h4",{children:"\ud83d\udd2c Micronutrient Profile"}),(0,r.jsx)("div",{className:"radar-chart-wrapper",children:(0,r.jsxs)("svg",{width:o,height:o,className:"radar-chart",children:[v.map(((e,t)=>(0,r.jsx)("circle",{cx:l,cy:c,r:e.r,fill:"none",stroke:"#e0e0e0",strokeWidth:"1",opacity:e.opacity},t))),h.map(((e,t)=>(0,r.jsx)("line",{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stroke:"#ccc",strokeWidth:"1",opacity:"0.7"},t))),p&&g.length>=3&&(0,r.jsx)("path",{d:p,fill:"rgba(54, 162, 235, 0.3)",stroke:"rgba(54, 162, 235, 0.8)",strokeWidth:"2",strokeLinejoin:"round"}),p&&2===g.length&&(0,r.jsx)("path",{d:p,fill:"none",stroke:"rgba(54, 162, 235, 0.8)",strokeWidth:"3",strokeLinecap:"round"}),g.map(((e,t)=>(0,r.jsx)("circle",{cx:e.x,cy:e.y,r:"4",fill:"rgba(54, 162, 235, 0.9)",stroke:"white",strokeWidth:"2"},t))),h.map(((e,t)=>{const n=e.labelX>160,a=e.labelX<140,i=e.labelY<c;let s="middle";n?s="start":a&&(s="end");let o="middle";return Math.abs(e.labelX-l)<15&&(o=i?"auto":"hanging"),(0,r.jsx)("text",{x:e.labelX,y:e.labelY,textAnchor:s,dominantBaseline:o,fontSize:"11",fill:"#666",className:"radar-label",style:{fontWeight:500},children:e.label},t)}))]})}),(0,r.jsxs)("div",{className:"micronutrient-values",children:[(0,r.jsx)("h5",{children:"\ud83d\udccb Detailed Values"}),(0,r.jsx)("div",{className:"micronutrient-grid",children:g.map(((e,t)=>(0,r.jsxs)("div",{className:"micronutrient-item",children:[(0,r.jsxs)("span",{className:"nutrient-name",children:[e.label,":"]}),(0,r.jsxs)("span",{className:"nutrient-value",children:[e.value<1?e.value.toFixed(2):e.value.toFixed(1)," ",e.unit]})]},t)))}),i.length>s.length&&(0,r.jsx)("div",{className:"additional-nutrients",children:(0,r.jsxs)("small",{children:["+",i.length-s.length," more nutrients available"]})})]}),(0,r.jsx)("style",{jsx:!0,children:"\n        .micronutrient-radar-container {\n          background: white;\n          border-radius: 12px;\n          padding: 20px;\n          margin: 20px 0;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          border: 1px solid #e1e5e9;\n        }\n        \n        .micronutrient-radar-container h4 {\n          margin: 0 0 16px 0;\n          color: #2c3e50;\n          font-size: 16px;\n          font-weight: 600;\n        }\n        \n        .radar-chart-wrapper {\n          display: flex;\n          justify-content: center;\n          margin-bottom: 20px;\n        }\n        \n        .radar-chart {\n          background: #fafafa;\n          border-radius: 8px;\n        }\n        \n        .radar-label {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n          font-weight: 500;\n        }\n        \n        .no-micronutrients {\n          text-align: center;\n          padding: 40px 20px;\n          color: #666;\n        }\n        \n        .no-data-icon {\n          font-size: 48px;\n          margin-bottom: 16px;\n        }\n        \n        .data-note {\n          font-size: 14px;\n          color: #888;\n          margin-top: 12px;\n        }\n        \n        .micronutrient-values h5 {\n          margin: 0 0 12px 0;\n          color: #34495e;\n          font-size: 14px;\n          font-weight: 600;\n        }\n        \n        .micronutrient-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n          gap: 8px;\n          margin-bottom: 12px;\n        }\n        \n        .micronutrient-item {\n          display: flex;\n          justify-content: space-between;\n          padding: 6px 12px;\n          background: #f8f9fa;\n          border-radius: 6px;\n          font-size: 13px;\n        }\n        \n        .nutrient-name {\n          color: #495057;\n          font-weight: 500;\n        }\n        \n        .nutrient-value {\n          color: #2c3e50;\n          font-weight: 600;\n        }\n        \n        .additional-nutrients {\n          text-align: center;\n          padding: 8px;\n          color: #6c757d;\n          font-style: italic;\n        }\n        \n        @media (max-width: 768px) {\n          .micronutrient-radar-container {\n            padding: 16px;\n          }\n          \n          .micronutrient-grid {\n            grid-template-columns: 1fr;\n          }\n        }\n      "})]})};var S=n(108),A=n(4553),F=n(7734),D=n(2185),_=n(6026),L=n(6150),E=n(1327),M=n(168),I=n(3243),T=n(3536),O=n.n(T);const z=e=>{let{foodLog:t=[],userProfile:n={}}=e;const[s,o]=(0,i.useState)(["vitamin_c","vitamin_d","iron","calcium"]),[l,c]=(0,i.useState)(30),[d,m]=(0,i.useState)("day"),[u,h]=(0,i.useState)(!0),g={vitamin_a:{value:900,unit:"mcg",female:700,male:900},vitamin_c:{value:90,unit:"mg",female:75,male:90},vitamin_d:{value:20,unit:"mcg",female:15,male:15},vitamin_e:{value:15,unit:"mg",female:15,male:15},vitamin_k:{value:120,unit:"mcg",female:90,male:120},thiamine:{value:1.2,unit:"mg",female:1.1,male:1.2},riboflavin:{value:1.3,unit:"mg",female:1.1,male:1.3},niacin:{value:16,unit:"mg",female:14,male:16},vitamin_b6:{value:1.7,unit:"mg",female:1.3,male:1.7},folate:{value:400,unit:"mcg",female:400,male:400},vitamin_b12:{value:2.4,unit:"mcg",female:2.4,male:2.4},biotin:{value:30,unit:"mcg",female:30,male:30},pantothenic_acid:{value:5,unit:"mg",female:5,male:5},calcium:{value:1e3,unit:"mg",female:1e3,male:1e3},iron:{value:8,unit:"mg",female:18,male:8},magnesium:{value:420,unit:"mg",female:320,male:420},zinc:{value:11,unit:"mg",female:8,male:11},selenium:{value:55,unit:"mcg",female:55,male:55},phosphorus:{value:700,unit:"mg",female:700,male:700},potassium:{value:3500,unit:"mg",female:2600,male:3400},sodium:{value:2300,unit:"mg",female:2300,male:2300},copper:{value:.9,unit:"mg",female:.9,male:.9},manganese:{value:2.3,unit:"mg",female:1.8,male:2.3},chromium:{value:35,unit:"mcg",female:25,male:35},molybdenum:{value:45,unit:"mcg",female:45,male:45}},p=(0,i.useMemo)((()=>{if(!t||!Array.isArray(t))return[];const e=new Set;return t.forEach((t=>{t&&t.micronutrients&&"object"===typeof t.micronutrients&&Object.keys(t.micronutrients).forEach((t=>{e.add(t)}))})),Array.from(e).sort()}),[t]),v=(0,i.useMemo)((()=>{if(!t||!Array.isArray(t)||0===t.length)return[];const e=e=>{if(!e)return null;const t=e.split("-");if(3===t.length){const e=parseInt(t[0],10),n=parseInt(t[1],10)-1,a=parseInt(t[2],10);return new Date(e,n,a)}return new Date(e)},n=new Date;n.setDate(n.getDate()-l);const i=t.filter((t=>{if(!t||!t.date)return!1;const a=e(t.date);return a>=n&&!isNaN(a.getTime())}));if(0===i.length)return[];const s=O()(i).groupBy((t=>{const n=e(t.date);switch(d){case"week":const e=new Date(n);return e.setDate(n.getDate()-n.getDay()),e.toISOString().split("T")[0];case"month":return"".concat(n.getFullYear(),"-").concat(String(n.getMonth()+1).padStart(2,"0"),"-01");default:return t.date}})).value();return Object.entries(s).map((t=>{let[n,i]=t;const s={};return i.forEach((e=>{e&&e.micronutrients&&"object"===typeof e.micronutrients&&Object.entries(e.micronutrients).forEach((e=>{let[t,n]=e;s[t]||(s[t]=0);const a=n&&"object"===typeof n?n.value:n;s[t]+=parseFloat(a||0)}))})),(0,a.A)((0,a.A)({period:n,date:e(n)},s),{},{entryCount:i.length})})).sort(((e,t)=>e.date-t.date))}),[t,l,d]),f=e=>{const t=g[e];if(!t)return null;return t[(null===n||void 0===n?void 0:n.gender)||"female"]||t.value},x={vitamin_a:"#FF6B6B",vitamin_c:"#4ECDC4",vitamin_d:"#45B7D1",vitamin_e:"#96CEB4",vitamin_k:"#FFEAA7",thiamine:"#DDA0DD",riboflavin:"#98D8C8",niacin:"#F7DC6F",vitamin_b6:"#BB8FCE",folate:"#85C1E9",vitamin_b12:"#F8C471",biotin:"#82E0AA",pantothenic_acid:"#F1948A",calcium:"#AED6F1",iron:"#CD853F",magnesium:"#90EE90",zinc:"#DEB887",selenium:"#F0E68C",phosphorus:"#DA70D6",potassium:"#87CEEB",sodium:"#FFB6C1",copper:"#D2691E",manganese:"#9370DB",chromium:"#20B2AA",molybdenum:"#FF69B4"},y=e=>{let{active:t,payload:n,label:a}=e;if(t&&n&&n.length){let e;if(a)if(a.includes("-")){const t=a.split("-");if(3===t.length){const n=parseInt(t[0],10),a=parseInt(t[1],10)-1,i=parseInt(t[2],10);e=new Date(n,a,i)}else e=new Date(a)}else e=new Date(a);else e=new Date;return(0,r.jsxs)("div",{className:"custom-tooltip",style:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #ccc",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},children:[(0,r.jsx)("p",{style:{margin:"0 0 8px 0",fontWeight:"bold"},children:e.toLocaleDateString()}),n.map((e=>{var t,n;const a=f(e.dataKey),i=a?(e.value/a*100).toFixed(1):null,s=(null===(t=g[e.dataKey])||void 0===t?void 0:t.unit)||"";return(0,r.jsxs)("p",{style:{margin:"4px 0",color:e.color,fontSize:"14px"},children:[(0,r.jsxs)("strong",{children:[e.dataKey.replace(/_/g," ").toUpperCase(),":"]})," ",null===(n=e.value)||void 0===n?void 0:n.toFixed(2)," ",s,i&&(0,r.jsxs)("span",{style:{marginLeft:"8px",fontSize:"12px",opacity:.8},children:["(",i,"% of RDA)"]})]},e.dataKey)}))]})}return null},j={"Water Soluble":["vitamin_c","thiamine","riboflavin","niacin","vitamin_b6","folate","vitamin_b12","biotin","pantothenic_acid"],"Fat Soluble":["vitamin_a","vitamin_d","vitamin_e","vitamin_k"],"Major Minerals":["calcium","phosphorus","magnesium","sodium","potassium"],"Trace Minerals":["iron","zinc","copper","manganese","selenium","chromium","molybdenum"]};return(0,r.jsxs)("div",{className:"vitamin-timeseries-tab",style:{padding:"20px"},children:[(0,r.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,r.jsx)("h3",{style:{marginBottom:"16px",color:"#2c3e50"},children:"\ud83d\udcc8 Nutrient Trends Over Time"}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px",marginBottom:"20px",padding:"16px",backgroundColor:"#f8f9fa",borderRadius:"8px"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:"Time Range:"}),(0,r.jsxs)("select",{value:l,onChange:e=>c(Number(e.target.value)),style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ddd"},children:[(0,r.jsx)("option",{value:7,children:"Last 7 days"}),(0,r.jsx)("option",{value:14,children:"Last 2 weeks"}),(0,r.jsx)("option",{value:30,children:"Last 30 days"}),(0,r.jsx)("option",{value:60,children:"Last 2 months"}),(0,r.jsx)("option",{value:90,children:"Last 3 months"}),(0,r.jsx)("option",{value:180,children:"Last 6 months"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:"Group By:"}),(0,r.jsxs)("select",{value:d,onChange:e=>m(e.target.value),style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ddd"},children:[(0,r.jsx)("option",{value:"day",children:"Daily"}),(0,r.jsx)("option",{value:"week",children:"Weekly"}),(0,r.jsx)("option",{value:"month",children:"Monthly"})]})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",marginTop:"32px"},children:[(0,r.jsx)("input",{type:"checkbox",checked:u,onChange:e=>h(e.target.checked),style:{marginRight:"8px"}}),"Show recommended intake lines"]})})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:"Quick Select:"}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[Object.keys(j).map((e=>(0,r.jsx)("button",{onClick:()=>(e=>{const t=j[e].filter((e=>p.includes(e)));o(t)})(e),style:{padding:"6px 12px",borderRadius:"4px",border:"1px solid #007bff",backgroundColor:"white",color:"#007bff",cursor:"pointer",fontSize:"12px"},onMouseOver:e=>e.target.style.backgroundColor="#007bff",onMouseOut:e=>e.target.style.backgroundColor="white",children:e},e))),(0,r.jsx)("button",{onClick:()=>o([]),style:{padding:"6px 12px",borderRadius:"4px",border:"1px solid #dc3545",backgroundColor:"white",color:"#dc3545",cursor:"pointer",fontSize:"12px"},children:"Clear All"})]})]}),(0,r.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,r.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:["Select Vitamins/Minerals to Track (",s.length," selected):"]}),(0,r.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"8px",maxHeight:"150px",overflowY:"auto",padding:"8px",border:"1px solid #ddd",borderRadius:"4px",backgroundColor:"white"},children:p.map((e=>(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",padding:"4px",cursor:"pointer",fontSize:"14px"},children:[(0,r.jsx)("input",{type:"checkbox",checked:s.includes(e),onChange:()=>(e=>{o((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]))})(e),style:{marginRight:"8px"}}),(0,r.jsxs)("span",{style:{color:x[e]||"#666"},children:["\u25cf ",e.replace(/_/g," ").toUpperCase()]}),g[e]&&(0,r.jsxs)("span",{style:{marginLeft:"4px",fontSize:"11px",color:"#666"},children:["(RDA: ",f(e)," ",g[e].unit,")"]})]},e)))})]})]}),v.length>0&&s.length>0?(0,r.jsx)("div",{style:{height:"500px",width:"100%"},children:(0,r.jsx)(S.u,{children:(0,r.jsxs)(A.b,{data:v,children:[(0,r.jsx)(F.d,{strokeDasharray:"3 3",stroke:"#e0e0e0"}),(0,r.jsx)(D.W,{dataKey:"period",tickFormatter:e=>{if(!e)return"";if(e.includes("-")){const t=e.split("-");if(3===t.length){const e=parseInt(t[0],10),n=parseInt(t[1],10)-1,a=parseInt(t[2],10);return new Date(e,n,a).toLocaleDateString()}}return new Date(e).toLocaleDateString()},stroke:"#666"}),(0,r.jsx)(_.h,{stroke:"#666"}),(0,r.jsx)(L.m,{content:(0,r.jsx)(y,{})}),(0,r.jsx)(E.s,{}),s.map((e=>(0,r.jsx)(M.N,{type:"monotone",dataKey:e,stroke:x[e]||"#666",strokeWidth:2,dot:{fill:x[e]||"#666",strokeWidth:2,r:4},connectNulls:!1,name:e.replace(/_/g," ").toUpperCase()},e))),u&&s.map((e=>{const t=f(e);return t?(0,r.jsx)(I.e,{y:t,stroke:x[e]||"#666",strokeDasharray:"5 5",strokeOpacity:.5,label:{value:"".concat(e.replace(/_/g," ").toUpperCase()," RDA"),position:"topRight",fontSize:10}},"".concat(e,"-ref")):null}))]})})}):(0,r.jsx)("div",{style:{textAlign:"center",padding:"40px",backgroundColor:"#f8f9fa",borderRadius:"8px",color:"#666"},children:0===v.length?(0,r.jsx)("p",{children:"No food data available for the selected time range."}):(0,r.jsx)("p",{children:"Please select at least one vitamin or mineral to display the chart."})}),s.length>0&&v.length>0&&(0,r.jsxs)("div",{style:{marginTop:"24px"},children:[(0,r.jsx)("h4",{style:{marginBottom:"16px"},children:"Summary Statistics"}),(0,r.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"16px"},children:s.map((e=>{var t,n,a,i;const s=v.map((t=>t[e])).filter((e=>void 0!==e&&null!==e));if(0===s.length)return null;const o=s.reduce(((e,t)=>e+t),0)/s.length,l=Math.max(...s),c=Math.min(...s),d=f(e),m=d?(o/d*100).toFixed(1):null,u=null===(t=g[e])||void 0===t?void 0:t.isPersonalized;return(0,r.jsxs)("div",{style:{padding:"16px",border:"1px solid #ddd",borderRadius:"8px",backgroundColor:"white"},children:[(0,r.jsx)("h5",{style:{margin:"0 0 8px 0",color:x[e]||"#666"},children:e.replace(/_/g," ").toUpperCase()}),(0,r.jsxs)("div",{style:{fontSize:"14px"},children:[(0,r.jsxs)("div",{children:["Average: ",(0,r.jsxs)("strong",{children:[o.toFixed(2)," ",null===(n=g[e])||void 0===n?void 0:n.unit]})]}),(0,r.jsxs)("div",{children:["Range: ",c.toFixed(2)," - ",l.toFixed(2)," ",null===(a=g[e])||void 0===a?void 0:a.unit]}),d&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[u?"Personalized RDA":"RDA",": ",d," ",null===(i=g[e])||void 0===i?void 0:i.unit,u&&(0,r.jsx)("span",{style:{color:"#2196f3",fontWeight:"bold"},children:"*"})]}),(0,r.jsxs)("div",{style:{color:parseFloat(m)>=100?"#28a745":parseFloat(m)>=75?"#ffc107":"#dc3545"},children:["Average intake: ",(0,r.jsxs)("strong",{children:[m,"% of ",u?"personalized":"standard"," RDA"]})]})]})]})]},e)}))})]}),Object.values(g).some((e=>e.isPersonalized))&&(0,r.jsxs)("div",{style:{marginTop:"20px",padding:"16px",backgroundColor:"#e3f2fd",borderRadius:"8px",border:"1px solid #2196f3"},children:[(0,r.jsx)("h4",{style:{margin:"0 0 8px 0",color:"#1565c0",fontSize:"16px"},children:"\ud83d\udccb Personalized Recommendations"}),(0,r.jsxs)("p",{style:{margin:"0 0 12px 0",fontSize:"14px",color:"#1976d2"},children:["Values marked with ",(0,r.jsx)("span",{style:{fontWeight:"bold",color:"#2196f3"},children:"*"})," have been personalized based on your profile:"]}),(0,r.jsxs)("ul",{style:{margin:"0",paddingLeft:"20px",fontSize:"13px",color:"#1976d2"},children:["female"===(null===n||void 0===n?void 0:n.gender)&&(0,r.jsx)("li",{children:"Gender-specific adjustments (e.g., higher iron needs for women)"}),(null===n||void 0===n?void 0:n.age)&&(n.age>=50||n.age<=18)&&(0,r.jsx)("li",{children:"Age-based modifications (e.g., increased vitamin D for elderly)"}),((null===n||void 0===n?void 0:n.hasLongCovid)||(null===n||void 0===n?void 0:n.longCovidSeverity))&&(0,r.jsx)("li",{children:"Long COVID severity adjustments for immune support nutrients"}),("high"===(null===n||void 0===n?void 0:n.activityLevel)||"very_high"===(null===n||void 0===n?void 0:n.activityLevel))&&(0,r.jsx)("li",{children:"Enhanced requirements for active lifestyle"})]}),((null===n||void 0===n?void 0:n.hasLongCovid)||(null===n||void 0===n?void 0:n.longCovidSeverity))&&(0,r.jsxs)("div",{style:{marginTop:"12px",padding:"8px",backgroundColor:"#fff3e0",borderRadius:"4px",fontSize:"12px",color:"#e65100"},children:[(0,r.jsx)("strong",{children:"Long COVID Note:"})," Recommendations for vitamin C, D, zinc, and selenium have been increased based on your severity level to support immune function and recovery."]})]})]})},B=()=>Intl.DateTimeFormat().resolvedOptions().timeZone,R=()=>{const e=B(),t=new Date,n=new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(t),a=n.find((e=>"year"===e.type)).value,i=n.find((e=>"month"===e.type)).value,s=n.find((e=>"day"===e.type)).value;return"".concat(a,"-").concat(i,"-").concat(s)},P=e=>{if(!e)return"";try{const t=(e=>{if(!e)return null;const t=e.split("-");if(3===t.length){const e=parseInt(t[0],10),n=parseInt(t[1],10)-1,a=parseInt(t[2],10);return new Date(e,n,a)}return new Date(e)})(e);if(!t||isNaN(t.getTime()))return e;const n=R(),a=(e=>{const t=B(),n=new Date;n.setDate(n.getDate()-e);const a=new Intl.DateTimeFormat("en-CA",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(n),i=a.find((e=>"year"===e.type)).value,s=a.find((e=>"month"===e.type)).value,o=a.find((e=>"day"===e.type)).value;return"".concat(i,"-").concat(s,"-").concat(o)})(1),i={weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:B()},s=t.toLocaleDateString("en-US",i);return e===n?"Today - ".concat(s):e===a?"Yesterday - ".concat(s):s}catch(t){return console.warn("Error formatting date header:",t),e}},U=["Breakfast","Morning Snack","Lunch","Afternoon Snack","Dinner","Late Night Snack"],V=["Add Food","Food Journal","Analysis","Trends"];const W=function(){const e=(0,s.Zp)(),[t,n]=(0,i.useState)([]),[c]=(0,i.useState)("unavailable"),[d,m]=(0,i.useState)(!1),[h,p]=(0,i.useState)(null),[v,f]=(0,i.useState)({age:30,gender:"female",weight:65,height:165,activityLevel:"moderate",hasLongCovid:!1,longCovidSeverity:"moderate"}),[x,y]=(0,i.useState)(!0),[j,b]=(0,i.useState)("Add Food"),[N,C]=(0,i.useState)(""),[S,A]=(0,i.useState)([]),[F,D]=(0,i.useState)(null),[_,L]=(0,i.useState)({}),[E,M]=(0,i.useState)("Breakfast"),[I,T]=(0,i.useState)((()=>(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))),[O,B]=(0,i.useState)((()=>R())),[W,G]=(0,i.useState)(!0),[H,Y]=(0,i.useState)(!1),[X,q]=(0,i.useState)(""),[J,Z]=(0,i.useState)(""),[K,Q]=(0,i.useState)([]),[$,ee]=(0,i.useState)(!1),[te,ne]=(0,i.useState)(""),[ae,ie]=(0,i.useState)(1),[se,oe]=(0,i.useState)(null),[le,re]=(0,i.useState)(null),[ce,de]=(0,i.useState)(!1),[me,ue]=(0,i.useState)({}),he=((e,t)=>{const[n,a]=(0,i.useState)(e);return(0,i.useEffect)((()=>{const n=setTimeout((()=>{a(e)}),t);return()=>clearTimeout(n)}),[e,t]),n})(N,300),ge=(0,i.useCallback)((async()=>{try{const t=localStorage.getItem("userData");if(!t)return void e("/login");const n=JSON.parse(t);p(n),n.id?await(async e=>{try{const t=(0,o.H9)(l.db,"users",e),n=await(0,o.x7)(t);if(n.exists()){const e=n.data();f(e)}else console.log("No user profile found in database"),f(null)}catch(t){console.error("Error fetching user profile:",t),Z("Failed to load user profile"),f(null)}})(n.id):(console.log("No user ID found - user profile not loaded"),f(null))}catch(J){console.error("Error checking authentication:",J),e("/login")}finally{y(!1)}}),[e]);(0,i.useEffect)((()=>{ge()}),[ge]);const pe=e=>{const t=e.toLowerCase();return["salmon","mackerel","sardines","tuna","trout","blueberries","strawberries","raspberries","blackberries","spinach","kale","broccoli","brussels sprouts","walnuts","almonds","chia seeds","flax seeds","turmeric","ginger","garlic","onion","olive oil","avocado","sweet potato","green tea","dark chocolate"].some((e=>t.includes(e)))?"beneficial":["processed meat","bacon","sausage","hot dog","french fries","fried chicken","fried","white bread","white rice","pastry","candy","soda","sugar","margarine","ice cream","chips"].some((e=>t.includes(e)))?"caution":"neutral"},ve=e=>{const t=e.time,n=t.match(/(\d+):/),a=n?parseInt(n[1],10):12,i=t.toLowerCase().includes("pm");let s=a;i&&12!==a&&(s+=12),i||12!==a||(s=0);const o=.2*(parseFloat(e.protein)||0),l=.1*(parseFloat(e.carbs)||0),r=.15*(parseFloat(e.fat)||0);let c=1;s<6||s>20?c=.7:s>=7&&s<=10?c=1.2:s>=17&&s<=19&&(c=.9);const d={Breakfast:1.3,"Morning Snack":.9,Lunch:1.1,"Afternoon Snack":.8,Dinner:.9,"Late Night Snack":.6,Snack:.8}[e.mealType]||1;let m=Math.min(100,10*(o+l+r))*c*d;if(e.longCovidAdjust&&null!==v&&void 0!==v&&v.hasLongCovid){m*={mild:.95,moderate:.85,severe:.75,"very severe":.65}[v.longCovidSeverity]||.85,e.longCovidBenefits&&e.longCovidBenefits.length>0&&(m*=1.1),e.longCovidCautions&&e.longCovidCautions.length>0&&(m*=.9)}return Math.min(100,Math.max(0,m))},fe=e=>{var t,n,i,s,o,l,r;console.log("handleSelectMeal called with:",e.name),D(e),C(e.name),A([]),m(!1);const c=(null===(t=e.nutritional_metrics)||void 0===t?void 0:t.nutrients_per_100g)||(null===(n=e.nutrients)||void 0===n?void 0:n.per100g)||{};let d=100,u="g",h="100g serving";if(null!==(i=e.nutritional_metrics)&&void 0!==i&&i.serving_options){const t=Object.values(e.nutritional_metrics.serving_options)[0];null!==t&&void 0!==t&&t.weight&&(d=t.weight,u=t.unit||"g",h=t.description)}console.log("Setting default serving:",{defaultServing:d,defaultUnit:u,defaultDescription:h});const g=xe(d,u,e);L({name:e.name,protein:((null===(s=c.protein)||void 0===s?void 0:s.value)*g).toFixed(1),carbs:((null===(o=c.carbs)||void 0===o?void 0:o.value)*g).toFixed(1),fat:((null===(l=c.fat)||void 0===l?void 0:l.value)*g).toFixed(1),calories:((null===(r=c.calories)||void 0===r?void 0:r.value)*g).toFixed(0),serving:d,servingUnit:u,servingDescription:h,micronutrients:c,longCovidBenefits:e.longCovidBenefits||[],longCovidCautions:e.longCovidCautions||[],longCovidRelevance:e.longCovidRelevance||{}}),setTimeout((()=>{L((e=>(0,a.A)({},e)))}),50)},xe=function(e){let t=arguments.length>2?arguments[2]:void 0;if("ml"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"g")){return e*(ye(null===t||void 0===t?void 0:t.name)||1)/100}return e/100},ye=e=>{if(!e||"string"!==typeof e)return 1;const t=e.toLowerCase(),n={water:1,milk:1.03,cream:1,oil:.92,juice:1.05,soup:1,broth:1,stock:1,coffee:1,tea:1,wine:.99,beer:1,yogurt:1.1,smoothie:1.1,sauce:1.1,syrup:1.3,honey:1.4};for(const[a,i]of Object.entries(n))if(t.includes(a))return i;return 1},je=(0,i.useCallback)((async()=>{const e=N.toLowerCase().trim();if(console.log("fetchSuggestions called with:",e),e.length<2)A([]);else{if(me[e])return console.log("Using cached results for:",e),void A(me[e]);try{console.log('Search for: "'.concat(e,'"'));let i=t;if(0===i.length){console.log("Fetching food database...");const e=(0,o.P)((0,o.rJ)(l.db,"meals"));i=(await(0,o.GG)(e)).docs.map((e=>(0,a.A)({id:e.id},e.data()))),n(i),console.log("Loaded ".concat(i.length," foods into cache"))}const s=i.filter((t=>{if(!t.name)return!1;const n=t.name.toLowerCase(),a=(t.category||"").toLowerCase(),i=(t.description||"").toLowerCase(),s=(t.tags||[]).map((e=>e.toLowerCase()));return n.includes(e)||n.startsWith(e)||a.includes(e)||i.includes(e)||s.some((t=>t.includes(e)))||n.split(" ").some((t=>t.startsWith(e)))})).map((t=>{var n,i;const s=(t.name||"").toLowerCase(),o=(t.category||"").toLowerCase(),l=(t.description||"").toLowerCase();let r=0;return s===e&&(r+=100),s.startsWith(e)&&(r+=50),s.split(" ").some((t=>t.startsWith(e)))&&(r+=30),s.includes(e)&&(r+=20),o.includes(e)&&(r+=15),l.includes(e)&&(r+=10),(null!==(n=t.nutritional_metrics)&&void 0!==n&&n.serving_options||null!==(i=t.nutritional_metrics)&&void 0!==i&&i.common_portions)&&(r+=5),(t.longCovidRelevance||t.longCovidBenefits||t.longCovidCautions)&&(r+=3),(0,a.A)((0,a.A)({},t),{},{searchMethod:"javascript",searchScore:r})})).sort(((e,t)=>t.searchScore!==e.searchScore?t.searchScore-e.searchScore:(e.name||"").localeCompare(t.name||"")));console.log("Found ".concat(s.length," results (showing all)")),ue((t=>(0,a.A)((0,a.A)({},t),{},{[e]:s}))),A(s)}catch(i){console.error("Search error:",i),A([])}}}),[N,me,t]),be=()=>{C(""),A([]),D(null),m(!1),L({})};(0,i.useEffect)((()=>{he.length<2?A([]):je()}),[he,je]);const Ne=(0,i.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(h&&h.id){ee(!0),1===e&&Q([]),ne("");try{const t=(0,o.P)((0,o.rJ)(l.db,"users",h.id,"food_journal"),(0,o.My)("date","desc"),(0,o.My)("createdAt","desc"),(0,o.AB)(20*e)),n=(await(0,o.GG)(t)).docs.map((e=>(0,a.A)({id:e.id},e.data())));Q(n),ie(e)}catch(t){console.error("Error fetching food log:",t),ne("Failed to load journal: ".concat(t.message))}finally{ee(!1)}}}),[h]);(0,i.useEffect)((()=>{h&&!x&&Ne(1)}),[h,x,Ne]);const Ce=()=>{e("/dashboard")};return x?(0,r.jsx)("div",{className:"food-tracker-container",children:(0,r.jsx)("div",{className:"loading-indicator",children:"Loading..."})}):h?(0,r.jsxs)("div",{className:"food-tracker-container",children:[(0,r.jsxs)("div",{className:"bg-animation",children:[(0,r.jsx)("div",{className:"card-glow"}),(0,r.jsx)("div",{className:"floating-shape shape-1"}),(0,r.jsx)("div",{className:"floating-shape shape-2"}),(0,r.jsx)("div",{className:"floating-shape shape-3"}),(0,r.jsx)("div",{className:"floating-shape shape-4"}),(0,r.jsx)("div",{className:"floating-shape shape-5"}),(0,r.jsx)("div",{className:"floating-shape shape-6"})]}),(0,r.jsxs)("div",{className:"food-tracker-content",children:[(0,r.jsxs)("div",{className:"tracker-header",children:[(0,r.jsx)("button",{onClick:Ce,className:"back-button",children:"\u2190 Back to Dashboard"}),(0,r.jsx)("button",{onClick:async()=>{console.log("Logout clicked - starting complete logout process");try{localStorage.removeItem("userData"),sessionStorage.clear(),p(null),y(!1),e("/login",{replace:!0})}catch(J){console.error("Error during logout:",J),localStorage.removeItem("userData"),sessionStorage.clear(),p(null),e("/login",{replace:!0})}},className:"logout-btn",children:"Logout"})]}),(0,r.jsx)("h2",{children:"\ud83c\udf7d\ufe0f Smart Meal Tracker"}),(0,r.jsx)("div",{className:"food-tabs",children:V.map((e=>(0,r.jsx)("button",{className:"food-tab".concat(j===e?" active":""),onClick:()=>b(e),children:e},e)))}),"Add Food"===j&&(0,r.jsx)(u,{search:N,setSearch:C,suggestions:S,setSuggestions:A,selectedMeal:F,setSelectedMeal:D,searchFocused:d,setSearchFocused:m,renderSearchInput:()=>(0,r.jsxs)("div",{className:"form-group search-group",children:[(0,r.jsx)("label",{children:"Search Food"}),(0,r.jsxs)("div",{className:"search-input-container ".concat(d?"search-focused":""),children:[(0,r.jsx)("input",{type:"text",value:N,onChange:e=>{const t=e.target.value;C(t),D(null),t.length<2&&A([])},onFocus:()=>m(!0),onBlur:()=>{setTimeout((()=>{m(!1),A([])}),200)},placeholder:"Search foods...",autoComplete:"off",className:"search-input"}),N.length>0&&(0,r.jsx)("button",{onClick:be,className:"clear-search-button",type:"button",title:"Clear search",children:"\u2715"}),(0,r.jsx)("div",{className:"search-status",children:S.length>0&&(0,r.jsxs)("span",{className:"result-count",children:[S.length," result",1!==S.length?"s":"",S.length>50&&(0,r.jsx)("span",{className:"large-result-hint",children:" - scroll to see more"})]})})]}),S.length>0&&d&&(0,r.jsxs)("div",{className:"suggestions-container",children:[(0,r.jsx)("ul",{className:"suggestions-list unlimited",children:S.map(((e,t)=>{var n;return(0,r.jsxs)("li",{onClick:()=>fe(e),onMouseDown:e=>e.preventDefault(),className:"suggestion-item",children:[(0,r.jsxs)("div",{className:"suggestion-main",children:[(0,r.jsx)("div",{className:"suggestion-name",children:e.name}),e.category&&(0,r.jsx)("div",{className:"suggestion-category",children:e.category}),e.searchScore&&(0,r.jsx)("div",{className:"suggestion-score",title:"Relevance: ".concat(e.searchScore),children:e.searchScore>=50?"\ud83c\udfaf":e.searchScore>=20?"\ud83d\udd0d":"\ud83d\udcdd"})]}),(0,r.jsxs)("div",{className:"suggestion-indicators",children:[(null===(n=e.nutritional_metrics)||void 0===n?void 0:n.serving_options)&&(0,r.jsx)("span",{className:"serving-indicator",title:"Has serving suggestions",children:"\ud83d\udccf"}),W&&(0,r.jsx)("span",{className:"covid-indicator ".concat(pe(e.name)),children:"beneficial"===pe(e.name)?"\u2705":"caution"===pe(e.name)?"\u26a0\ufe0f":"\u2139\ufe0f"})]})]},e.id||t)}))}),S.length>20&&(0,r.jsx)("div",{className:"search-tips",children:(0,r.jsxs)("small",{children:["\ud83d\udca1 Tip: Type more specific terms to narrow down results, or scroll to browse all ",S.length," matches"]})})]})]}),handleSelectMeal:fe,clearSearch:be,fields:_,setFields:L,mealType:E,setMealType:M,time:I,setTime:T,date:O,setDate:B,longCovidAdjust:W,setLongCovidAdjust:G,editingEntry:se,handleCancelEdit:()=>{oe(null),L({}),D(null),C(""),q(""),Z("")},handleFieldChange:e=>{const{name:t,value:n}=e.target;"serving"===t?(L((e=>(0,a.A)((0,a.A)({},e),{},{[t]:n}))),F&&function(e){var t,n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"g";if(!F)return void console.log("No selected meal for recalculation");const s=parseFloat(e);if(isNaN(s)||s<=0)return void console.log("Invalid serving size for recalculation:",e);const o=(null===(t=F.nutritional_metrics)||void 0===t?void 0:t.nutrients_per_100g)||(null===(n=F.nutrients)||void 0===n?void 0:n.per100g)||{};let l;if("ml"===i){const e=ye(F.name)||1,t=s*e;l=t/100,console.log("Liquid conversion:",{serving:s+"ml",density:e,weightInGrams:t+"g",ratio:l})}else l=s/100,console.log("Solid conversion:",{serving:s+"g",ratio:l});console.log("Recalculating nutrients:",{selectedMeal:F.name,newServing:s,unit:i,ratio:l,originalNutrients:o}),L((e=>{var t,n,r,c;const d=(0,a.A)((0,a.A)({},e),{},{serving:s,servingUnit:i});return void 0!==(null===(t=o.protein)||void 0===t?void 0:t.value)&&(d.protein=(o.protein.value*l).toFixed(1)),void 0!==(null===(n=o.carbs)||void 0===n?void 0:n.value)&&(d.carbs=(o.carbs.value*l).toFixed(1)),void 0!==(null===(r=o.fat)||void 0===r?void 0:r.value)&&(d.fat=(o.fat.value*l).toFixed(1)),void 0!==(null===(c=o.calories)||void 0===c?void 0:c.value)&&(d.calories=(o.calories.value*l).toFixed(0)),d.micronutrients={},Object.entries(o).forEach((e=>{let[t,n]=e;["protein","carbs","fat","calories","name","unit"].includes(t)||void 0===(null===n||void 0===n?void 0:n.value)||(d.micronutrients[t]=(0,a.A)((0,a.A)({},n),{},{value:(n.value*l).toFixed(1)}))})),console.log("Updated fields after recalculation:",d),d}))}(n)):L((e=>(0,a.A)((0,a.A)({},e),{},{[t]:n})))},handleServingSelection:function(e,t){var n,i,s,o,l,r;let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"g";if(console.log("Serving selection:",{weight:e,description:t,unit:c}),!F)return void console.error("No selected meal for serving calculation");const d=parseFloat(e);if(isNaN(d)||d<=0)return void console.error("Invalid weight provided:",e);const m=xe(d,c,F),u=(null===F||void 0===F||null===(n=F.nutritional_metrics)||void 0===n?void 0:n.nutrients_per_100g)||(null===F||void 0===F||null===(i=F.nutrients)||void 0===i?void 0:i.per100g)||{};if(!u||0===Object.keys(u).length)return console.warn("No nutrition data found for selected meal"),void L((e=>(0,a.A)((0,a.A)({},e),{},{serving:d,servingUnit:c})));const h={protein:(((null===(s=u.protein)||void 0===s?void 0:s.value)||0)*m).toFixed(1),carbs:(((null===(o=u.carbs)||void 0===o?void 0:o.value)||0)*m).toFixed(1),fat:(((null===(l=u.fat)||void 0===l?void 0:l.value)||0)*m).toFixed(1),calories:(((null===(r=u.calories)||void 0===r?void 0:r.value)||0)*m).toFixed(0)};console.log("Calculated nutrition for serving:",h),L((e=>(0,a.A)((0,a.A)({},e),{},{serving:d,servingUnit:c,protein:h.protein,carbs:h.carbs,fat:h.fat,calories:h.calories}))),q("Serving updated to ".concat(t," (").concat(d).concat(c,")")),setTimeout((()=>q("")),2e3)},handleTimeChange:e=>{const t=e.target.value;if(!t)return;const n=new Date("2000-01-01T".concat(t)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});T(n)},convertTo24Hour:e=>{if(!e)return"";const[t,n]=e.split(" ");if(!t||!n)return e;let[a,i]=t.split(":");return"12"===a&&(a="00"),"PM"===n&&(a=String(parseInt(a,10)+12)),a=String(a),"".concat(a.padStart(2,"0"),":").concat(i)},handleLogFood:async()=>{if(console.log("=== LOGGING FOOD ==="),console.log("Date being saved:",O),h&&h.id){Y(!0),Z(""),q("");try{if(!_.name)throw new Error("Food name is required");const e={name:_.name,protein:parseFloat(_.protein)||0,carbs:parseFloat(_.carbs)||0,fat:parseFloat(_.fat)||0,calories:parseFloat(_.calories)||0,serving:parseFloat(_.serving)||100,micronutrients:_.micronutrients||{},mealType:E,time:I,date:O,longCovidAdjust:W,longCovidBenefits:_.longCovidBenefits||[],longCovidCautions:_.longCovidCautions||[],longCovidRelevance:_.longCovidRelevance||{},mealId:(null===F||void 0===F?void 0:F.id)||null};if(e.metabolicEfficiency=ve(e),se)await(0,o.mZ)((0,o.H9)(l.db,"users",h.id,"food_journal",se.id),(0,a.A)((0,a.A)({},e),{},{updatedAt:o.Dc.now()})),Q((t=>t.map((t=>t.id===se.id?(0,a.A)((0,a.A)((0,a.A)({},t),e),{},{id:se.id}):t)))),q("Food entry updated successfully!"),oe(null);else{e.createdAt=o.Dc.now();const t=await(0,o.gS)((0,o.rJ)(l.db,"users",h.id,"food_journal"),e),n=(0,a.A)({id:t.id},e);Q((e=>[n,...e])),q("Food logged successfully!")}L({}),D(null),C("")}catch(e){console.error("Error logging food:",e),Z("Failed to ".concat(se?"update":"log"," food: ").concat(e.message))}finally{Y(!1)}}else Z("Please log in to save your meals")},loading:H,success:X,error:J,mealTypes:U,pyodideStatus:c,foodLog:K,MicronutrientRadarChart:k}),"Food Journal"===j&&(0,r.jsx)(g,{foodLog:K,journalPage:ae,logLoading:$,journalError:te,success:X,deleteConfirmId:le,setDeleteConfirmId:re,deleteLoading:ce,handleDeleteEntry:async e=>{if(h&&e){de(!0),ne("");try{await(0,o.kd)((0,o.H9)(l.db,"users",h.id,"food_journal",e)),Q((t=>t.filter((t=>t.id!==e)))),q("Food entry deleted successfully!"),setTimeout((()=>q("")),3e3)}catch(t){console.error("Error deleting entry:",t),ne("Failed to delete entry: ".concat(t.message))}finally{de(!1),re(null)}}},fetchFoodLog:Ne,handleEditEntry:e=>{L({name:e.name,protein:e.protein,carbs:e.carbs,fat:e.fat,calories:e.calories,serving:e.serving||100,micronutrients:e.micronutrients||{},longCovidBenefits:e.longCovidBenefits||[],longCovidCautions:e.longCovidCautions||[],longCovidRelevance:e.longCovidRelevance||{}}),M(e.mealType),T(e.time),B(e.date),G(e.longCovidAdjust||!1),C(e.name),oe(e);const n=t.find((t=>t.name.toLowerCase()===e.name.toLowerCase()||t.id===e.mealId));if(n)D(n),console.log("Original meal found for editing:",n.name);else{const t={name:e.name,nutritional_metrics:{nutrients_per_100g:{protein:{value:e.protein/(e.serving||100)*100},carbs:{value:e.carbs/(e.serving||100)*100},fat:{value:e.fat/(e.serving||100)*100},calories:{value:e.calories/(e.serving||100)*100}}}};D(t),console.log("Created mock meal for editing:",e.name)}b("Add Food")},ENTRIES_PER_PAGE:20,formatDateHeader:P}),"Analysis"===j&&(0,r.jsx)(w,{foodLog:K,userProfile:v}),"Trends"===j&&(0,r.jsx)(z,{foodLog:K,userProfile:v})]})]}):(0,r.jsx)("div",{className:"food-tracker-container",children:(0,r.jsxs)("div",{className:"auth-required",children:[(0,r.jsx)("h2",{children:"Authentication Required"}),(0,r.jsx)("p",{children:"Please log in to use the food tracker."}),(0,r.jsx)("button",{onClick:Ce,className:"back-button",children:"Back to Dashboard"})]})})}}}]);
//# sourceMappingURL=211.1c953a26.chunk.js.map